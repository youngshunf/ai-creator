# 智能工作流系统实施计划 (Implementation Plan)

**版本**: v1.0
**日期**: 2025-12-30
**目标**: 构建基于 Meta-Agent 的智能工作流生成与执行系统，集成自主浏览器代理与富交互 UI。

## 1. 总体路线图 (Roadmap)

我们采用 **"Core First, Agent Second, UI Last"** 的策略，确保基础设施稳固后再构建上层智能。

*   **Phase 1: Agent Core 基础设施升级** (预计 3 天)
    *   目标: 让系统支持 "Skill" 和 "Subgraph" 嵌套调用。
*   **Phase 2: 自主浏览器代理 (Autonomous Browser Agent)** (预计 4 天)
    *   目标: 实现基于视觉的、目标驱动的浏览器操作能力。
*   **Phase 3: Meta-Agent (工作流生成器)** (预计 4 天)
    *   目标: 实现 "自然语言 -> YAML Graph" 的转化引擎。
*   **Phase 4: 富交互 UI 集成 (A2UI)** (预计 3 天)
    *   目标: 实现前端动态渲染 Agent 生成的 UI。

---

## 2. 详细执行步骤

### Phase 1: Agent Core 基础设施升级
> 重点: `packages/agent-core`

- [ ] **1.1 实现 Skill Manager** (`agent_core/skill/`)
    - [ ] 定义 `Skill` YAML Schema (Tools + Instructions + Examples)。
    - [ ] 实现 `SkillRegistry` 和 `SkillLoader`。
    - [ ] 实现 `RuntimeContext.equip_skill()` 方法，支持动态注入 Prompt 和 Tool。
- [ ] **1.2 支持 Subgraph (嵌套图)** (`agent_core/graph/`)
    - [ ] 升级 `GraphCompiler`，支持 `node.agent` 字段。
    - [ ] 实现 Graph 递归加载与状态隔离 (Child State -> Parent State 映射)。
- [ ] **1.3 标准化 Agent 定义** (`agent-definitions/`)
    - [ ] 按照新规范重构现有 Agent YAML（添加详细 metadata, inputs schema）。
    - [ ] 创建基础通用 Agent (如 `universal-search-agent`).

### Phase 2: 自主浏览器代理 (Autonomous Browser Agent)
> 重点: `packages/agent-core`, `apps/sidecar`

- [ ] **2.1 集成 Browser Use / Playwright**
    - [ ] 在 `agent_core.tools.browser` 中封装 `BrowserContext`。
    - [ ] 实现 `Screenshot` 和 `DOM Snapshot` 采集工具。
- [ ] **2.2 构建 Vision Agent Graph**
    - [ ] 定义 `browser-use-agent.yaml`。
    - [ ] 设计 Prompt: 接收 (Screenshot, Goal, History)，输出 (Action: Click/Type/Scroll)。
    - [ ] 实现 `ActionExecutor`，将 LLM 输出转化为 Playwright 操作。
- [ ] **2.3 混合模式测试**
    - [ ] 编写测试用例: "登录 GitHub 并 Star 本项目"。
    - [ ] 验证 "API Tool" (API调用) 与 "Browser Tool" (UI操作) 在同一个 Graph 中的协同。

### Phase 3: Meta-Agent (工作流生成器)
> 重点: `agent-definitions/meta-agent/`

- [ ] **3.1 构建 RAG 索引**
    - [ ] 实现 `ToolIndexer`: 扫描 `agent-definitions` 和 `tools`，生成向量索引。
    - [ ] 实现 `RetrieverTool`: 供 Meta-Agent 查询 "有哪些工具可用"。
- [ ] **3.2 开发 Meta-Agent Graph**
    - [ ] 编写 `workflow-generator.yaml`。
    - [ ] **Prompt Engineering**: 训练它理解 YAML Schema、Inputs 提取、Error Handling。
    - [ ] 实现 `ValidatorNode`: 生成 YAML 后自动运行 `GraphValidator`，报错则自我修正。
- [ ] **3.3 集成前端创建入口**
    - [ ] 桌面端新增 "Create Agent" 聊天窗口。

### Phase 4: 富交互 UI 集成 (A2UI)
> 重点: `apps/desktop`, `packages/agent-core`

- [ ] **4.1 定义 UI Protocol**
    - [ ] 在 `agent_core` 中定义 `UIMessage` 结构 (JSON schema)。
- [ ] **4.2 前端渲染器개발** (`apps/desktop`)
    - [ ] 实现 `NativeUIRenderer` 组件。
    - [ ] 映射基础组件: `Form`, `Input`, `Markdown`, `Chart`, `Button`。
- [ ] **4.3 闭环交互**
    - [ ] 实现 "Form Submit" -> "Agent Resume" 的数据回传链路。

---

## 3. 验收标准 (Definition of Done)

1.  **功能验收**:
    *   用户输入 "给科技博主发私信"，系统自动生成包含 `browser_use_agent` 的 Graph。
    *   点击运行，Agent 能自主打开浏览器，完成操作。
    *   操作过程中，Agent 能弹出一个 UI 表单让用户确认文案 (A2UI)。
2.  **代码质量**:
    *   所有新模块覆盖率 > 80%。
    *   通过 `GraphValidator` 的严格检查。

## 4. 资源需求

*   **LLM**: 开发阶段主要依赖 Claude 3.5 Sonnet (Coding & Vision)。
*   **Environment**: 本地 Python 3.10+, Node.js 18+。
