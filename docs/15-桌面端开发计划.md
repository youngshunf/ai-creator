# 创流 (CreatorFlow) 桌面端分阶段开发计划

> 版本: v1.1 | 更新: 2025-12-28 | 状态: 已确认

---

## 一、项目概述

### 1.1 项目目标

基于 `docs/01-系统架构.md` 和 `docs/02-桌面端设计.md` 的设计，开发创流桌面端应用，实现自媒体创作者的 AI 超级大脑。

### 1.2 技术栈

```yaml
桌面端:
  框架: Tauri 2.0 + Python Sidecar
  前端: Vite 6 + React 19 + TypeScript 5 + shadcn/ui + Tailwind CSS 4
  状态管理: Zustand + TanStack Query v5
  路由: TanStack Router
  编辑器: TipTap

后端:
  Rust Core: Tauri 后端、IPC、系统集成
  Python Sidecar: Agent 执行、浏览器自动化、LLM 网关
  本地存储: SQLite
  浏览器自动化: Playwright
```

### 1.3 现有代码状态

| 模块 | 状态 | 说明 |
|------|------|------|
| `packages/agent-core/` | ✅ 完成 | Graph 加载/编译、工具注册、运行时接口 |
| `apps/sidecar/` | ⚠️ 框架 | LocalExecutor 基础实现，main.py 占位 |
| `agent-definitions/` | ✅ 完成 | 4个 Graph 定义文件 |
| `tauri-app/` | ❌ 空 | 待开发 |

---

## 二、分阶段开发计划

### Phase 1: 基础框架 (Month 1-2)

**目标**: 搭建完整的桌面端技术骨架，实现端到端通信

#### Sprint 1.1 (Week 1-2): Tauri 项目初始化

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| Tauri 2.0 + Vite + React 项目创建 | P0 | 2d | 可运行的空壳应用 |
| shadcn/ui + Tailwind CSS 4 配置 | P0 | 1d | UI 基础组件库 |
| TanStack Router 路由配置 | P0 | 1d | 路由框架 |
| Zustand + TanStack Query 状态管理 | P0 | 1d | 状态管理架构 |
| 基础布局组件 (Sidebar/Header/MainLayout) | P0 | 2d | 应用骨架 UI |
| TypeScript 类型定义 | P0 | 1d | 类型系统 |

**里程碑 M1.1**: Tauri 应用可启动，显示基础布局

#### Sprint 1.2 (Week 3-4): Rust Core 基础

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| Tauri Commands 定义 (IPC 接口) | P0 | 2d | 前后端通信接口 |
| SQLite 本地数据库集成 | P0 | 2d | 本地存储能力 |
| 系统托盘 + 通知管理 | P1 | 1d | 系统集成 |
| 窗口管理 (多窗口支持) | P1 | 1d | 窗口控制 |
| 凭证加密存储 (Keychain) | P0 | 2d | 安全存储 |
| 自动更新框架 | P1 | 1d | 更新机制 |

**里程碑 M1.2**: Rust Core 基础功能完成，IPC 通信正常

#### Sprint 1.3 (Week 5-6): Python Sidecar 完善

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| JSON-RPC over stdio 服务实现 | P0 | 3d | Sidecar 通信层 |
| Sidecar 进程管理 (启动/停止/重启) | P0 | 2d | 进程生命周期 |
| LocalExecutor 完善 (错误处理/超时) | P0 | 2d | 执行器增强 |
| 健康检查 + 心跳机制 | P0 | 1d | 稳定性保障 |
| 日志系统 (结构化日志) | P0 | 1d | 可观测性 |
| PyInstaller 打包脚本 | P0 | 1d | Sidecar 二进制 |

**里程碑 M1.3**: Sidecar 可独立运行，JSON-RPC 通信正常

#### Sprint 1.4 (Week 7-8): 端到端集成

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| 前端 Sidecar 客户端封装 | P0 | 2d | useSidecar Hook |
| Agent 调用 Hook (useAgent) | P0 | 2d | Agent 调用封装 |
| 执行状态 UI (进度/事件流) | P0 | 2d | 执行可视化 |
| 错误处理 + 重试机制 | P0 | 1d | 容错能力 |
| 开发环境热重载配置 | P1 | 1d | 开发体验 |
| 集成测试框架搭建 | P1 | 2d | 测试基础 |

**里程碑 M1.4**: 前端可调用 Sidecar 执行 Graph，事件流正常显示

#### Phase 1 验收标准

```yaml
功能验收:
  - [ ] Tauri 应用可在 Windows/macOS/Linux 启动
  - [ ] 前端 UI 框架完整，路由正常
  - [ ] Sidecar 进程可正常启动/停止
  - [ ] JSON-RPC 通信正常，延迟 < 50ms
  - [ ] 可执行 content-creation Graph
  - [ ] 执行事件流实时显示

性能验收:
  - [ ] 应用启动时间 < 3s
  - [ ] Sidecar 启动时间 < 2s
  - [ ] 内存占用 < 200MB (空闲状态)
```

---

### Phase 2: 核心功能 (Month 3-4)

**目标**: 实现 P0 级核心功能，达到 MVP 可用状态

#### Sprint 2.1 (Week 9-10): AI 创作模块

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| TipTap 富文本编辑器集成 | P0 | 3d | 创作编辑器 |
| AI 写作功能 (调用 content-creation Graph) | P0 | 2d | AI 生成能力 |
| 写作风格模板 (10+ 种) | P0 | 2d | 风格选择 |
| 内容续写/改写/扩写 | P0 | 2d | 编辑增强 |
| 草稿自动保存 | P0 | 1d | 数据安全 |

**里程碑 M2.1**: AI 写作功能可用，支持多种风格

#### Sprint 2.2 (Week 11-12): LLM 网关集成

> 更新: 2025-12-28 | 云端 LLM 网关已完成，用户登录后自动获取 API Token

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| **CloudLLMClient 实现** (HTTP 调用云端网关) | P0 | 2d | LLM 调用客户端 |
| **LLMConfigManager 实现** (Token 自动保存) | P0 | 1d | 配置管理 |
| **登录流程集成** (登录后自动获取 Token) | P0 | 1d | Token 分发 |
| 模型列表展示 | P1 | 1d | 模型选择 |
| 用量统计展示 | P1 | 1d | 用量追踪 |
| 连接状态检测 | P1 | 1d | 健康检查 |

**注**:
- 云端 LLM 网关已完成，包含多供应商支持、故障转移、熔断器、速率限制等功能
- 桌面端无需用户手动配置，登录后自动获取并保存 API Token
- 每个用户有独立的 API Token，用于用量追踪和配额控制

详细设计参见:
- [Agent-Runtime 10.LLM统一接口设计](./05-Agent-Runtime.md#10-llm-统一接口设计)
- [云端服务设计 2.8桌面端调用方式](./04-云端服务设计.md#28-桌面端调用方式)

**里程碑 M2.2**: LLM 云端网关集成完成，桌面端可调用 AI 能力

#### Sprint 2.3 (Week 13-14): 平台适配器 (P0 平台)

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| Playwright 浏览器管理器 | P0 | 2d | 浏览器池 |
| 小红书适配器 | P0 | 3d | 小红书发布 |
| 微信公众号适配器 (官方 API) | P0 | 2d | 公众号发布 |
| 微博适配器 | P0 | 2d | 微博发布 |
| 凭证管理 (Cookie 存储/恢复) | P0 | 1d | 登录态管理 |

**里程碑 M2.3**: 3 个 P0 平台发布功能可用

#### Sprint 2.4 (Week 15-16): 发布中心

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| 发布中心 UI | P0 | 2d | 发布界面 |
| 多平台选择 + 内容适配 | P0 | 2d | 平台适配 |
| 发布预览 | P0 | 1d | 预览功能 |
| 定时发布 (APScheduler) | P0 | 2d | 定时任务 |
| 发布状态追踪 | P0 | 1d | 状态管理 |
| 发布失败重试 | P0 | 1d | 容错机制 |

**里程碑 M2.4**: 发布中心完成，支持定时发布

#### Phase 2 验收标准

```yaml
功能验收:
  - [ ] AI 写作功能完整，支持 10+ 种风格
  - [ ] 支持 Claude/OpenAI/通义千问 等 5+ 供应商
  - [ ] 小红书/公众号/微博 发布成功率 > 95%
  - [ ] 定时发布误差 < 1 分钟
  - [ ] 发布失败自动重试

性能验收:
  - [ ] AI 首字节响应 < 3s
  - [ ] 发布任务启动 < 2s
  - [ ] 单次发布完成 < 60s
```

---

### Phase 3: 增强功能 (Month 5-6)

**目标**: 完成 P1 功能，提升用户体验，准备商业化

#### Sprint 3.1 (Week 17-18): 数据运营模块

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| 数据采集 Agent | P0 | 3d | 数据抓取 |
| 统一数据看板 UI | P0 | 2d | 数据展示 |
| 趋势图表 (Recharts) | P0 | 2d | 数据可视化 |
| 热点追踪 (BettaFish 集成) | P1 | 2d | 热点发现 |
| AI 选题推荐 | P0 | 1d | 智能推荐 |

**里程碑 M3.1**: 数据看板完成，热点追踪可用

#### Sprint 3.2 (Week 19-20): 更多平台支持

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| 抖音适配器 | P1 | 3d | 抖音发布 |
| B站适配器 | P1 | 2d | B站发布 |
| 批量发布功能 | P1 | 2d | 批量操作 |
| 智能排期 | P1 | 2d | AI 排期 |
| 半自动发布降级 | P0 | 1d | 降级方案 |

**里程碑 M3.2**: 5 个平台发布支持，批量发布可用

#### Sprint 3.3 (Week 21-22): AI 增强功能

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| AI 配图推荐 | P1 | 2d | 图片推荐 |
| 视频脚本生成 | P1 | 2d | 脚本生成 |
| 多版本对比 | P1 | 2d | 版本管理 |
| 智能排版 | P0 | 2d | 自动排版 |
| 内容质量检测 | P1 | 2d | 质量保障 |

**里程碑 M3.3**: AI 创作能力增强

#### Sprint 3.4 (Week 23-24): 用户系统 + 商业化

| 任务 | 优先级 | 工时 | 交付物 |
|------|--------|------|--------|
| 用户注册/登录 | P0 | 2d | 用户系统 |
| 订阅管理 | P0 | 2d | 订阅功能 |
| 配额管理 | P0 | 2d | 配额控制 |
| 云端同步 (可选) | P1 | 2d | 数据同步 |
| 应用打包 + 签名 | P0 | 2d | 发布准备 |

**里程碑 M3.4**: MVP 完成，可商业化发布

#### Phase 3 验收标准

```yaml
功能验收:
  - [ ] 数据看板展示完整
  - [ ] 支持 5 个主流平台发布
  - [ ] AI 配图/视频脚本功能可用
  - [ ] 用户注册/登录/订阅完整
  - [ ] 配额管理正常工作

性能验收:
  - [ ] 安装包体积 < 150MB
  - [ ] 数据采集延迟 < 1h
  - [ ] 批量发布 10 篇 < 10min
```

---

## 三、关键文件路径

### 3.1 待创建的核心文件

```
tauri-app/
├── src/                              # React 前端
│   ├── main.tsx
│   ├── App.tsx
│   ├── routes/                       # TanStack Router
│   │   ├── __root.tsx
│   │   ├── index.tsx
│   │   ├── creation/
│   │   ├── publish/
│   │   ├── analytics/
│   │   └── settings/
│   ├── components/
│   │   ├── ui/                       # shadcn/ui
│   │   ├── layout/
│   │   └── editor/
│   ├── hooks/
│   │   ├── useAgent.ts
│   │   ├── useSidecar.ts
│   │   └── useHotTopics.ts
│   ├── stores/
│   │   ├── useAppStore.ts
│   │   └── useDraftStore.ts
│   └── lib/
│       ├── sidecar-client.ts
│       └── llm-client.ts
│
├── src-tauri/
│   ├── src/
│   │   ├── main.rs
│   │   ├── lib.rs
│   │   ├── commands/
│   │   │   ├── mod.rs
│   │   │   ├── agent.rs
│   │   │   └── storage.rs
│   │   ├── sidecar/
│   │   │   └── manager.rs
│   │   └── storage/
│   │       └── credential.rs
│   ├── Cargo.toml
│   └── tauri.conf.json
│
├── package.json
├── vite.config.ts
├── tailwind.config.ts
└── tsconfig.json
```

### 3.2 待完善的现有文件

```
apps/sidecar/src/sidecar/
├── main.py                           # 完善 JSON-RPC 服务入口
├── server.py                         # 实现 JSON-RPC 服务器
├── executor.py                       # 完善 LocalExecutor
├── tools/
│   ├── browser.py                    # 实现浏览器发布工具
│   └── credential.py                 # 实现凭证管理工具
├── automation/
│   ├── browser/
│   │   └── manager.py                # 实现浏览器管理器
│   └── scheduler.py                  # 实现定时任务
└── llm/
    ├── gateway.py                    # 实现 LLM 网关
    ├── provider.py                   # 实现供应商管理
    └── rate_limiter.py               # 实现速率限制
```

---

## 四、风险和应对策略

| 风险 | 概率 | 影响 | 应对策略 |
|------|------|------|---------|
| Playwright 反检测失败 | 高 | 高 | 使用 stealth 插件 + 降级为半自动发布 |
| Sidecar 打包体积过大 | 中 | 中 | 使用 Nuitka 替代 PyInstaller |
| 跨平台兼容性问题 | 中 | 中 | CI/CD 多平台测试 |
| LLM API 不稳定 | 中 | 高 | 多供应商故障转移 + 熔断降级 |
| 平台政策变更 | 高 | 高 | 监控平台公告 + 快速适配 |

---

## 五、里程碑总结

| 里程碑 | 时间 | 交付物 | 关键验收 |
|--------|------|--------|---------|
| **M1** | Month 2 末 | 基础框架 | 端到端通信正常，可执行 Graph |
| **M2** | Month 4 末 | 核心功能 | AI 写作 + 3 平台发布 + 定时发布 |
| **M3** | Month 6 末 | MVP 发布 | 5 平台 + 数据看板 + 用户系统 |

---

## 六、相关文档

- [系统架构](./01-系统架构.md)
- [桌面端设计](./02-桌面端设计.md)
- [需求规格](./13-需求规格.md)
- [补充需求规格](./14-补充需求规格.md)

---

> 文档版本: v1.0
> 更新日期: 2025-12-28
> 作者: @Ysf
