# A2UI 集成评估报告

**评估对象**: [google/A2UI](https://github.com/google/A2UI)
**评估时间**: 2025-12-30
**评估结论**: **高度推荐集成 (High Recommendation)**

## 1. A2UI 简介
A2UI (Agent to UI) 是 Google 开源的一个**声明式 UI 协议**。它允许 Agent 通过发送 JSON 数据来描述界面，而无需编写前端代码。前端应用（Client）通过标准渲染器将这些 JSON 渲染为原生组件（React/Flutter/etc）。

**核心价值**:
*   **安全性**: Agent 不直接生成可执行代码 (JS/HTML)，避免 XSS 风险。
*   **一致性**: UI 由宿主应用（我们的桌面端）的原生组件库渲染，保证视觉风格统一。
*   **交互性**: 支持从 UI 回传事件给 Agent，形成闭环。

## 2. 集成可行性分析

### 2.1 架构匹配度 (⭐⭐⭐⭐⭐)
*   **前端**: 我们的桌面端使用 Tauri + React。A2UI 官方提供了 React 渲染器示例，可以直接集成或参考实现。
*   **通讯**: 当前 Sidecar 与 Frontend 通过 JSON-RPC 通讯。A2UI 的消息体本质上也是 JSON，完全兼容现有通道。

### 2.2 实现难度 (Medium)
虽然概念匹配，但在工程落地层面有一定工作量：

1.  **Frontend (React)**:
    *   需要引入或实现一个 `A2UIRenderer` 组件。
    *   需要定义一套 "Component Map"，将 A2UI 的 JSON 节点映射到我们现有的 Design System 组件（如 `Button`, `Card`, `Table`）。

2.  **Backend (Agent Core)**:
    *   需要定义一个新的 `AgentEventType`，例如 `UI_RENDER`。
    *   需要让 LLM 学会输出 A2UI 格式的 JSON。这可以通过 Skill (Prompt Injection) 来实现。

## 3. 集成方案设计

### 3.1 场景举例
**用户需求**: "帮我生成一个关于 AI 发展的调查问卷。"
**Agent 行为**:
1.  Agent 构思问卷结构。
2.  **不集成 A2UI**: Agent 输出一段 Markdown 文本，用户只能看不能填。
3.  **集成 A2UI**: Agent 输出如下 JSON：
    ```json
    {
      "type": "form",
      "components": [
        {"type": "input", "label": "姓名", "id": "name"},
        {"type": "radio", "label": "职业", "options": ["开发者", "学生", "其他"]}
      ]
    }
    ```
4.  **桌面端**: 立即渲染出一个真实的、可交互的表单。用户填写后，点击提交，数据直接回传给 Agent。

### 3.2 渲染器集成 (Proposal)

不直接使用 Google 的库（可能较重或依赖特定样式），而是**借鉴其协议思想，实现一个轻量级的 `NativeUIRenderer`**。

**协议定义 (简化版)**:
```typescript
interface UIComponent {
  type: 'card' | 'text' | 'button' | 'input' | 'table';
  props: Record<string, any>;
  children?: UIComponent[];
  events?: {
    onClick?: string; // Action ID
  }
}
```

## 4. 风险与挑战

1.  **Token 消耗**: 描述复杂 UI 需要大量的 JSON，可能增加 Token 成本。
    *   *对策*: 仅在必要时（如需要用户填表、确认复杂信息）才使用 UI 生成，平时使用 Markdown。
2.  **模型能力**: 只有较强的模型 (Claude 3.5 / GPT-4) 才能稳定生成合法的 UI JSON。
    *   *对策*: 在 System Prompt 中提供严格的 One-Shot 示例。

## 5. 结论

集成 A2UI (或类似机制) 将极大提升 Agent 的 "富交互" 能力，使其从 "聊天机器人" 进化为 "应用生成器"。

**建议路线**:
1.  **Phase 1**: 在 `agent-core` 定义 `UIGenerator` Skill。
2.  **Phase 2**: 在前端实现基础组件 (Card, Button, Input) 的 JSON 映射渲染。
3.  **Phase 3**: 实现 "User Submit -> Agent Resume" 的交互闭环。
