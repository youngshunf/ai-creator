# 创流 (CreatorFlow) - 移动端设计

> uni-app x 纯云端方案 | 版本: v2.0 | 更新: 2025-12-25

## 1. 设计理念

### 1.1 移动端定位

```yaml
核心定位: 轻量采集 + 云端能力 + 多端发布

特点:
  - 纯云端模式，无本地 Python 环境
  - 所有 AI Agent 通过云端执行
  - 素材快速采集（拍照、录音、截图）
  - 想法随时记录，自动同步
  - 数据概览，随时查看运营效果

目标用户:
  - 移动办公创作者
  - 需要随时记录灵感的用户
  - 查看数据和管理发布的用户
  - 轻度创作和审核场景
```

### 1.2 与桌面端对比

| 能力 | 桌面端 (Tauri) | 移动端 (uni-app x) |
|------|---------------|-------------------|
| **技术栈** | Tauri 2.0 + React + Rust | uni-app x + Vue 3 + UTS |
| **Python Sidecar** | ✅ 本地运行 | ❌ 不支持 |
| **浏览器自动化** | ✅ 本地 Playwright | ☁️ 云端执行 |
| **AI Agent** | ✅ 本地/云端可选 | ☁️ 仅云端 |
| **定时任务** | ✅ 本地 APScheduler | ☁️ 云端调度 |
| **数据存储** | ✅ 本地 SQLite | ✅ 本地 + 云端同步 |
| **素材采集** | ✅ 文件系统 | ✅ 相机/相册/录音 |
| **离线使用** | ✅ 完整功能 | ⚠️ 仅草稿/缓存 |
| **发布平台** | Windows/macOS/Linux | iOS/Android/微信小程序 |

### 1.3 核心优势

| 优势 | 描述 |
|------|------|
| **多端发布** | 一套代码同时发布 iOS、Android、微信小程序 |
| **原生性能** | UTS 编译为原生代码，无 WebView 性能损耗 |
| **生态成熟** | 插件丰富，文档完善，社区活跃 |
| **开发效率** | Vue 3 语法，TypeScript 支持，上手快 |
| **国内适配** | 针对国内平台优化，兼容性好 |

---

## 2. 技术架构

### 2.1 架构概览

```text
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          移动端应用 (uni-app x)                                   │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────┐ │
│  │                        前端 UI (Vue 3 + UTS)                                │ │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌──────────┐ │ │
│  │  │  快速记录  │ │  素材采集  │ │  内容浏览  │ │  数据概览  │ │ 消息中心 │ │ │
│  │  │  想法速记  │ │  拍照录音  │ │  草稿管理  │ │  简化看板  │ │ 推送通知 │ │ │
│  │  │  语音转文  │ │  相册选择  │ │  作品列表  │ │  趋势图表  │ │ 任务状态 │ │ │
│  │  └────────────┘ └────────────┘ └────────────┘ └────────────┘ └──────────┘ │ │
│  └──────────────────────────────────┬─────────────────────────────────────────┘ │
│                                     │                                           │
│  ┌──────────────────────────────────┴─────────────────────────────────────────┐ │
│  │                           本地能力层 (UTS 插件)                             │ │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐              │ │
│  │  │  本地存储  │ │  相机相册  │ │  推送服务  │ │  生物识别  │              │ │
│  │  │  SQLite    │ │  媒体采集  │ │  FCM/APNs  │ │  指纹/面容  │              │ │
│  │  └────────────┘ └────────────┘ └────────────┘ └────────────┘              │ │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐              │ │
│  │  │  网络状态  │ │  文件管理  │ │  分享扩展  │ │  后台任务  │              │ │
│  │  │  离线检测  │ │  缓存管理  │ │  系统分享  │ │  数据同步  │              │ │
│  │  └────────────┘ └────────────┘ └────────────┘ └────────────┘              │ │
│  └──────────────────────────────────┬─────────────────────────────────────────┘ │
│                                     │ HTTPS + SSE                               │
│                                     │                                           │
│  iOS / Android / 微信小程序                                                      │
└─────────────────────────────────────┼───────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            云端服务 (FastAPI)                                    │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────┐ │
│  │                            API Gateway                                      │ │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐         │ │
│  │  │ 认证鉴权 │ │ 限流熔断 │ │ 请求路由 │ │ 事件推送 │ │ 推送服务 │         │ │
│  │  │  JWT     │ │ Sentinel │ │ Router   │ │ SSE/WS   │ │ FCM/APNs │         │ │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘         │ │
│  └────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────┐ │
│  │                            核心业务服务                                     │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐      │ │
│  │  │  Agent 服务  │ │   发布服务   │ │   数据服务   │ │   同步服务   │      │ │
│  │  │  AI 创作    │ │  浏览器池    │ │  分析引擎    │ │  实时同步    │      │ │
│  │  │  Graph 执行 │ │  定时发布    │ │  BettaFish   │ │  冲突解决    │      │ │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘      │ │
│  └────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 目录结构

```text
services/mobile-app/
├── src/
│   ├── App.uvue                    # 应用入口
│   ├── main.uts                    # 主入口文件
│   ├── manifest.json               # 应用配置
│   ├── pages.json                  # 页面路由配置
│   │
│   ├── pages/                      # 页面
│   │   ├── index/                  # 首页
│   │   │   └── index.uvue
│   │   ├── capture/                # 素材采集
│   │   │   ├── photo.uvue          # 拍照
│   │   │   ├── record.uvue         # 录音
│   │   │   └── gallery.uvue        # 相册
│   │   ├── ideas/                  # 想法记录
│   │   │   ├── list.uvue           # 想法列表
│   │   │   └── edit.uvue           # 编辑想法
│   │   ├── content/                # 内容管理
│   │   │   ├── drafts.uvue         # 草稿箱
│   │   │   ├── published.uvue      # 已发布
│   │   │   └── detail.uvue         # 内容详情
│   │   ├── analytics/              # 数据看板
│   │   │   ├── overview.uvue       # 数据概览
│   │   │   └── trends.uvue         # 趋势分析
│   │   ├── messages/               # 消息中心
│   │   │   └── index.uvue
│   │   └── profile/                # 个人中心
│   │       ├── index.uvue
│   │       ├── accounts.uvue       # 账号管理
│   │       └── settings.uvue       # 设置
│   │
│   ├── components/                 # 组件
│   │   ├── common/                 # 通用组件
│   │   │   ├── NavBar.uvue
│   │   │   ├── TabBar.uvue
│   │   │   ├── Loading.uvue
│   │   │   └── Empty.uvue
│   │   ├── capture/                # 采集组件
│   │   │   ├── CameraView.uvue
│   │   │   ├── AudioRecorder.uvue
│   │   │   └── MediaPicker.uvue
│   │   ├── content/                # 内容组件
│   │   │   ├── IdeaCard.uvue
│   │   │   ├── DraftCard.uvue
│   │   │   └── ContentEditor.uvue
│   │   └── analytics/              # 数据组件
│   │       ├── StatCard.uvue
│   │       ├── TrendChart.uvue
│   │       └── PlatformStats.uvue
│   │
│   ├── composables/                # 组合式函数
│   │   ├── useAuth.uts             # 认证
│   │   ├── useApi.uts              # API 调用
│   │   ├── useSync.uts             # 数据同步
│   │   ├── useOffline.uts          # 离线支持
│   │   ├── useCapture.uts          # 媒体采集
│   │   └── usePush.uts             # 推送通知
│   │
│   ├── api/                        # API 层
│   │   ├── client.uts              # HTTP 客户端
│   │   ├── agent.uts               # Agent API
│   │   ├── content.uts             # 内容 API
│   │   ├── publish.uts             # 发布 API
│   │   ├── analytics.uts           # 数据 API
│   │   └── sync.uts                # 同步 API
│   │
│   ├── stores/                     # 状态管理 (Pinia)
│   │   ├── user.uts                # 用户状态
│   │   ├── content.uts             # 内容状态
│   │   ├── sync.uts                # 同步状态
│   │   └── settings.uts            # 设置状态
│   │
│   ├── utils/                      # 工具函数
│   │   ├── storage.uts             # 本地存储
│   │   ├── crypto.uts              # 加密工具
│   │   ├── format.uts              # 格式化
│   │   └── validate.uts            # 验证工具
│   │
│   ├── plugins/                    # UTS 原生插件
│   │   ├── camera/                 # 相机插件
│   │   ├── biometric/              # 生物识别
│   │   ├── push/                   # 推送插件
│   │   └── share/                  # 分享插件
│   │
│   └── static/                     # 静态资源
│       ├── images/
│       ├── icons/
│       └── fonts/
│
├── uni_modules/                    # uni-app 插件
│   ├── uni-icons/
│   ├── uni-ui/
│   └── cool-ui/                    # Cool UI 组件库
│
├── unpackage/                      # 打包输出
├── package.json
├── tsconfig.json
└── vite.config.ts
```

---

## 3. 核心功能实现

### 3.1 云端 API 客户端

```typescript
// src/api/client.uts

import { ref } from 'vue'

// 类型定义
type RequestMethod = 'GET' | 'POST' | 'PUT' | 'DELETE'

interface RequestConfig {
  method?: RequestMethod
  headers?: Record<string, string>
  data?: any
  timeout?: number
}

interface ApiResponse<T = any> {
  success: boolean
  data: T
  message?: string
  error?: string
}

// API 客户端类
export class ApiClient {
  private baseUrl: string
  private authToken: string | null = null

  constructor(baseUrl: string) {
    this.baseUrl = baseUrl
  }

  setAuthToken(token: string): void {
    this.authToken = token
  }

  clearAuthToken(): void {
    this.authToken = null
  }

  async request<T>(
    endpoint: string,
    config: RequestConfig = {}
  ): Promise<ApiResponse<T>> {
    const url = `${this.baseUrl}${endpoint}`
    const method = config.method || 'GET'
    const timeout = config.timeout || 30000

    const headers: Record<string, string> = {
      'Content-Type': 'application/json',
      ...config.headers
    }

    if (this.authToken) {
      headers['Authorization'] = `Bearer ${this.authToken}`
    }

    return new Promise((resolve, reject) => {
      uni.request({
        url,
        method,
        header: headers,
        data: config.data,
        timeout,
        success: (res) => {
          if (res.statusCode >= 200 && res.statusCode < 300) {
            resolve({
              success: true,
              data: res.data as T
            })
          } else if (res.statusCode === 401) {
            // Token 过期，触发重新登录
            uni.$emit('auth:expired')
            reject(new Error('认证已过期'))
          } else {
            resolve({
              success: false,
              data: null as T,
              error: (res.data as any)?.message || '请求失败'
            })
          }
        },
        fail: (err) => {
          reject(new Error(err.errMsg || '网络错误'))
        }
      })
    })
  }

  // 便捷方法
  get<T>(endpoint: string, config?: RequestConfig): Promise<ApiResponse<T>> {
    return this.request<T>(endpoint, { ...config, method: 'GET' })
  }

  post<T>(endpoint: string, data?: any, config?: RequestConfig): Promise<ApiResponse<T>> {
    return this.request<T>(endpoint, { ...config, method: 'POST', data })
  }

  put<T>(endpoint: string, data?: any, config?: RequestConfig): Promise<ApiResponse<T>> {
    return this.request<T>(endpoint, { ...config, method: 'PUT', data })
  }

  delete<T>(endpoint: string, config?: RequestConfig): Promise<ApiResponse<T>> {
    return this.request<T>(endpoint, { ...config, method: 'DELETE' })
  }
}

// 全局实例
export const apiClient = new ApiClient('https://api.creatorflow.com')
```

### 3.2 Agent API 调用

```typescript
// src/api/agent.uts

import { apiClient, type ApiResponse } from './client'

// 类型定义
interface AgentEvent {
  eventType: string
  nodeName: string
  data: any
}

interface ArticleResult {
  title: string
  content: string
  images: string[]
  tags: string[]
}

interface HotTopic {
  topic: string
  heatScore: number
  trend: 'rising' | 'stable' | 'declining'
  sentiment: {
    positive: number
    neutral: number
    negative: number
  }
  platforms: string[]
}

interface ViralContentResult {
  selectedTopic: string
  angle: string
  content: ArticleResult
  publishTiming: string
}

// Agent API 服务
export const agentApi = {
  /**
   * 创建文章 (云端 Agent 执行)
   */
  async createArticle(
    topic: string,
    style: string,
    platform: string
  ): Promise<ApiResponse<ArticleResult>> {
    return apiClient.post('/api/v1/agent/create-article', {
      topic,
      style,
      platform
    })
  },

  /**
   * 创建爆款内容 (使用 BettaFish)
   */
  async createViralContent(
    niche: string,
    platform: string,
    contentType: string
  ): Promise<ApiResponse<ViralContentResult>> {
    return apiClient.post('/api/v1/agent/viral-content', {
      niche,
      targetPlatform: platform,
      contentType
    })
  },

  /**
   * 获取热点话题
   */
  async getHotTopics(
    platform: string = 'all',
    category?: string,
    limit: number = 20
  ): Promise<ApiResponse<{ topics: HotTopic[], insights: string }>> {
    return apiClient.post('/api/v1/bettafish/hot-topics', {
      platform,
      category,
      timeRange: '24h',
      limit
    })
  },

  /**
   * 执行自定义 Graph
   */
  async executeGraph(
    graphName: string,
    inputs: Record<string, any>
  ): Promise<ApiResponse<any>> {
    return apiClient.post('/api/v1/agent/execute-graph', {
      graphName,
      inputs
    })
  },

  /**
   * 获取 Graph 执行状态 (SSE)
   */
  subscribeToGraphEvents(
    runId: string,
    onEvent: (event: AgentEvent) => void,
    onComplete: () => void,
    onError: (error: Error) => void
  ): () => void {
    // 使用 uni.request 轮询或 WebSocket
    // uni-app x 暂不支持原生 SSE，使用轮询方案
    let isActive = true

    const poll = async () => {
      while (isActive) {
        try {
          const response = await apiClient.get<{ events: AgentEvent[], completed: boolean }>(
            `/api/v1/agent/run/${runId}/events`
          )

          if (response.success && response.data) {
            response.data.events.forEach(onEvent)

            if (response.data.completed) {
              onComplete()
              return
            }
          }

          // 等待 1 秒后继续轮询
          await new Promise(resolve => setTimeout(resolve, 1000))
        } catch (error) {
          onError(error as Error)
          return
        }
      }
    }

    poll()

    // 返回取消函数
    return () => {
      isActive = false
    }
  }
}
```

### 3.3 素材采集

```typescript
// src/composables/useCapture.uts

import { ref } from 'vue'

// 类型定义
interface CaptureResult {
  tempFilePath: string
  type: 'image' | 'video' | 'audio'
  size: number
  duration?: number
  width?: number
  height?: number
}

interface UploadResult {
  assetId: string
  url: string
  thumbnailUrl?: string
}

export function useCapture() {
  const isCapturing = ref(false)
  const lastCapture = ref<CaptureResult | null>(null)

  /**
   * 拍照
   */
  async function takePhoto(options: {
    quality?: number
    compressed?: boolean
    saveToAlbum?: boolean
  } = {}): Promise<CaptureResult> {
    isCapturing.value = true

    try {
      const result = await new Promise<CaptureResult>((resolve, reject) => {
        uni.chooseImage({
          count: 1,
          sizeType: options.compressed ? ['compressed'] : ['original'],
          sourceType: ['camera'],
          success: (res) => {
            const file = res.tempFiles[0]
            resolve({
              tempFilePath: file.path,
              type: 'image',
              size: file.size,
              width: (file as any).width,
              height: (file as any).height
            })
          },
          fail: (err) => {
            reject(new Error(err.errMsg || '拍照失败'))
          }
        })
      })

      lastCapture.value = result

      // 保存到相册
      if (options.saveToAlbum) {
        uni.saveImageToPhotosAlbum({
          filePath: result.tempFilePath,
          success: () => console.log('已保存到相册'),
          fail: (err) => console.warn('保存失败', err)
        })
      }

      return result
    } finally {
      isCapturing.value = false
    }
  }

  /**
   * 从相册选择
   */
  async function pickFromGallery(options: {
    maxCount?: number
    mediaType?: ('image' | 'video')[]
    compressed?: boolean
  } = {}): Promise<CaptureResult[]> {
    isCapturing.value = true

    try {
      const result = await new Promise<CaptureResult[]>((resolve, reject) => {
        uni.chooseMedia({
          count: options.maxCount || 9,
          mediaType: options.mediaType || ['image'],
          sizeType: options.compressed ? ['compressed'] : ['original'],
          sourceType: ['album'],
          success: (res) => {
            const results = res.tempFiles.map(file => ({
              tempFilePath: file.tempFilePath,
              type: file.fileType as 'image' | 'video',
              size: file.size,
              duration: file.duration,
              width: file.width,
              height: file.height
            }))
            resolve(results)
          },
          fail: (err) => {
            reject(new Error(err.errMsg || '选择失败'))
          }
        })
      })

      if (result.length > 0) {
        lastCapture.value = result[0]
      }

      return result
    } finally {
      isCapturing.value = false
    }
  }

  /**
   * 录音
   */
  async function recordAudio(options: {
    maxDuration?: number
    format?: 'mp3' | 'aac'
  } = {}): Promise<CaptureResult> {
    const recorderManager = uni.getRecorderManager()

    return new Promise((resolve, reject) => {
      recorderManager.onStart(() => {
        isCapturing.value = true
      })

      recorderManager.onStop((res) => {
        isCapturing.value = false
        const result: CaptureResult = {
          tempFilePath: res.tempFilePath,
          type: 'audio',
          size: res.fileSize,
          duration: res.duration
        }
        lastCapture.value = result
        resolve(result)
      })

      recorderManager.onError((err) => {
        isCapturing.value = false
        reject(new Error(err.errMsg || '录音失败'))
      })

      recorderManager.start({
        duration: (options.maxDuration || 60) * 1000,
        format: options.format || 'mp3',
        sampleRate: 44100,
        numberOfChannels: 1,
        encodeBitRate: 128000
      })
    })
  }

  /**
   * 停止录音
   */
  function stopRecording(): void {
    const recorderManager = uni.getRecorderManager()
    recorderManager.stop()
  }

  /**
   * 上传素材到云端
   */
  async function uploadToCloud(
    capture: CaptureResult,
    options: { category?: string } = {}
  ): Promise<UploadResult> {
    return new Promise((resolve, reject) => {
      uni.uploadFile({
        url: 'https://api.creatorflow.com/api/v1/assets/upload',
        filePath: capture.tempFilePath,
        name: 'file',
        formData: {
          type: capture.type,
          category: options.category || 'general'
        },
        success: (res) => {
          if (res.statusCode === 200) {
            const data = JSON.parse(res.data)
            resolve({
              assetId: data.assetId,
              url: data.url,
              thumbnailUrl: data.thumbnailUrl
            })
          } else {
            reject(new Error('上传失败'))
          }
        },
        fail: (err) => {
          reject(new Error(err.errMsg || '上传失败'))
        }
      })
    })
  }

  return {
    isCapturing,
    lastCapture,
    takePhoto,
    pickFromGallery,
    recordAudio,
    stopRecording,
    uploadToCloud
  }
}
```

### 3.4 想法快速记录

```typescript
// src/composables/useIdeas.uts

import { ref, computed } from 'vue'
import { apiClient } from '@/api/client'

// 类型定义
interface Idea {
  id: string
  content: string
  attachments: string[]
  tags: string[]
  createdAt: number
  updatedAt: number
  synced: boolean
}

interface IdeaInput {
  content: string
  attachments?: string[]
  tags?: string[]
}

// 本地存储键
const STORAGE_KEY = 'creatorflow_ideas'

export function useIdeas() {
  const ideas = ref<Idea[]>([])
  const isLoading = ref(false)
  const isSyncing = ref(false)

  // 未同步的想法数量
  const unsyncedCount = computed(() =>
    ideas.value.filter(i => !i.synced).length
  )

  /**
   * 从本地加载想法
   */
  function loadFromLocal(): void {
    try {
      const stored = uni.getStorageSync(STORAGE_KEY)
      if (stored) {
        ideas.value = JSON.parse(stored) as Idea[]
      }
    } catch (error) {
      console.error('加载本地想法失败:', error)
    }
  }

  /**
   * 保存到本地
   */
  function saveToLocal(): void {
    try {
      uni.setStorageSync(STORAGE_KEY, JSON.stringify(ideas.value))
    } catch (error) {
      console.error('保存本地想法失败:', error)
    }
  }

  /**
   * 创建新想法
   */
  async function createIdea(input: IdeaInput): Promise<Idea> {
    const now = Date.now()
    const idea: Idea = {
      id: `idea_${now}_${Math.random().toString(36).substr(2, 9)}`,
      content: input.content,
      attachments: input.attachments || [],
      tags: input.tags || [],
      createdAt: now,
      updatedAt: now,
      synced: false
    }

    // 添加到列表开头
    ideas.value.unshift(idea)
    saveToLocal()

    // 尝试同步到云端
    syncIdea(idea)

    return idea
  }

  /**
   * 更新想法
   */
  async function updateIdea(id: string, updates: Partial<IdeaInput>): Promise<void> {
    const index = ideas.value.findIndex(i => i.id === id)
    if (index === -1) return

    const idea = ideas.value[index]
    Object.assign(idea, updates, {
      updatedAt: Date.now(),
      synced: false
    })

    saveToLocal()
    syncIdea(idea)
  }

  /**
   * 删除想法
   */
  async function deleteIdea(id: string): Promise<void> {
    const index = ideas.value.findIndex(i => i.id === id)
    if (index === -1) return

    ideas.value.splice(index, 1)
    saveToLocal()

    // 同步删除到云端
    try {
      await apiClient.delete(`/api/v1/ideas/${id}`)
    } catch (error) {
      console.warn('删除同步失败:', error)
    }
  }

  /**
   * 同步单个想法到云端
   */
  async function syncIdea(idea: Idea): Promise<void> {
    try {
      const response = await apiClient.post('/api/v1/ideas', {
        id: idea.id,
        content: idea.content,
        attachments: idea.attachments,
        tags: idea.tags,
        createdAt: idea.createdAt,
        updatedAt: idea.updatedAt
      })

      if (response.success) {
        const index = ideas.value.findIndex(i => i.id === idea.id)
        if (index !== -1) {
          ideas.value[index].synced = true
          saveToLocal()
        }
      }
    } catch (error) {
      console.warn('同步想法失败:', error)
    }
  }

  /**
   * 同步所有未同步的想法
   */
  async function syncAll(): Promise<void> {
    if (isSyncing.value) return

    isSyncing.value = true
    const unsynced = ideas.value.filter(i => !i.synced)

    try {
      await Promise.all(unsynced.map(syncIdea))
    } finally {
      isSyncing.value = false
    }
  }

  /**
   * 从云端拉取想法
   */
  async function pullFromCloud(): Promise<void> {
    isLoading.value = true

    try {
      const response = await apiClient.get<{ ideas: Idea[] }>('/api/v1/ideas')

      if (response.success && response.data) {
        // 合并本地和云端数据
        const cloudIdeas = response.data.ideas
        const localUnsyncedIds = new Set(
          ideas.value.filter(i => !i.synced).map(i => i.id)
        )

        // 保留本地未同步的，更新其他
        ideas.value = [
          ...ideas.value.filter(i => localUnsyncedIds.has(i.id)),
          ...cloudIdeas.filter(i => !localUnsyncedIds.has(i.id)).map(i => ({
            ...i,
            synced: true
          }))
        ].sort((a, b) => b.createdAt - a.createdAt)

        saveToLocal()
      }
    } finally {
      isLoading.value = false
    }
  }

  // 初始化加载本地数据
  loadFromLocal()

  return {
    ideas,
    isLoading,
    isSyncing,
    unsyncedCount,
    createIdea,
    updateIdea,
    deleteIdea,
    syncAll,
    pullFromCloud
  }
}
```

### 3.5 离线支持

```typescript
// src/composables/useOffline.uts

import { ref, onMounted, onUnmounted } from 'vue'

// 类型定义
interface PendingAction {
  id: string
  type: 'create_idea' | 'update_idea' | 'delete_idea' | 'upload_asset' | 'sync_draft'
  payload: any
  createdAt: number
  retryCount: number
}

const PENDING_ACTIONS_KEY = 'creatorflow_pending_actions'

export function useOffline() {
  const isOnline = ref(true)
  const pendingActions = ref<PendingAction[]>([])
  const isSyncing = ref(false)

  /**
   * 加载待处理操作
   */
  function loadPendingActions(): void {
    try {
      const stored = uni.getStorageSync(PENDING_ACTIONS_KEY)
      if (stored) {
        pendingActions.value = JSON.parse(stored)
      }
    } catch (error) {
      console.error('加载待处理操作失败:', error)
    }
  }

  /**
   * 保存待处理操作
   */
  function savePendingActions(): void {
    try {
      uni.setStorageSync(PENDING_ACTIONS_KEY, JSON.stringify(pendingActions.value))
    } catch (error) {
      console.error('保存待处理操作失败:', error)
    }
  }

  /**
   * 添加待处理操作
   */
  function queueAction(
    type: PendingAction['type'],
    payload: any
  ): string {
    const action: PendingAction = {
      id: `action_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      type,
      payload,
      createdAt: Date.now(),
      retryCount: 0
    }

    pendingActions.value.push(action)
    savePendingActions()

    // 如果在线，立即尝试执行
    if (isOnline.value) {
      executePendingActions()
    }

    return action.id
  }

  /**
   * 执行单个操作
   */
  async function executeAction(action: PendingAction): Promise<boolean> {
    try {
      switch (action.type) {
        case 'create_idea':
        case 'update_idea':
          // 由 useIdeas 处理
          break
        case 'upload_asset':
          // 由 useCapture 处理
          break
        case 'sync_draft':
          // 由 useDrafts 处理
          break
      }
      return true
    } catch (error) {
      console.error(`执行操作失败 [${action.type}]:`, error)
      return false
    }
  }

  /**
   * 执行所有待处理操作
   */
  async function executePendingActions(): Promise<void> {
    if (isSyncing.value || !isOnline.value) return
    if (pendingActions.value.length === 0) return

    isSyncing.value = true

    const completed: string[] = []
    const failed: PendingAction[] = []

    for (const action of pendingActions.value) {
      const success = await executeAction(action)

      if (success) {
        completed.push(action.id)
      } else {
        action.retryCount++
        if (action.retryCount < 3) {
          failed.push(action)
        } else {
          console.warn(`操作重试次数超限，已放弃: ${action.id}`)
        }
      }
    }

    pendingActions.value = failed
    savePendingActions()

    isSyncing.value = false

    if (completed.length > 0) {
      uni.showToast({
        title: `已同步 ${completed.length} 项`,
        icon: 'success'
      })
    }
  }

  /**
   * 网络状态变化处理
   */
  function handleNetworkChange(result: { isConnected: boolean }): void {
    const wasOffline = !isOnline.value
    isOnline.value = result.isConnected

    // 从离线恢复到在线，执行待处理操作
    if (wasOffline && isOnline.value) {
      uni.showToast({
        title: '网络已恢复',
        icon: 'none'
      })
      executePendingActions()
    } else if (!isOnline.value) {
      uni.showToast({
        title: '已离线，数据将在联网后同步',
        icon: 'none'
      })
    }
  }

  // 生命周期
  onMounted(() => {
    loadPendingActions()

    // 检查初始网络状态
    uni.getNetworkType({
      success: (res) => {
        isOnline.value = res.networkType !== 'none'
      }
    })

    // 监听网络变化
    uni.onNetworkStatusChange(handleNetworkChange)
  })

  onUnmounted(() => {
    uni.offNetworkStatusChange(handleNetworkChange)
  })

  return {
    isOnline,
    pendingActions,
    isSyncing,
    queueAction,
    executePendingActions
  }
}
```

### 3.6 推送通知

```typescript
// src/composables/usePush.uts

import { ref, onMounted } from 'vue'
import { apiClient } from '@/api/client'

// 类型定义
interface PushMessage {
  id: string
  title: string
  body: string
  type: 'publish_success' | 'publish_failed' | 'schedule_reminder' | 'analytics_update' | 'system'
  data?: Record<string, any>
  receivedAt: number
  read: boolean
}

export function usePush() {
  const messages = ref<PushMessage[]>([])
  const unreadCount = ref(0)
  const pushToken = ref<string | null>(null)

  /**
   * 初始化推送
   */
  async function initPush(): Promise<void> {
    // #ifdef APP-PLUS
    // 获取推送权限
    const permission = await new Promise<boolean>((resolve) => {
      plus.push.getClientInfo({
        success: () => resolve(true),
        fail: () => resolve(false)
      })
    })

    if (!permission) {
      console.warn('推送权限未开启')
      return
    }

    // 获取推送 Token
    plus.push.getClientInfoAsync((info) => {
      pushToken.value = info.clientid
      registerToken(info.clientid)
    })

    // 监听推送消息
    plus.push.addEventListener('receive', (msg) => {
      handlePushMessage(msg)
    }, false)

    plus.push.addEventListener('click', (msg) => {
      handlePushClick(msg)
    }, false)
    // #endif

    // #ifdef MP-WEIXIN
    // 微信小程序订阅消息
    uni.requestSubscribeMessage({
      tmplIds: ['模板ID1', '模板ID2'],
      success: (res) => {
        console.log('订阅消息:', res)
      }
    })
    // #endif
  }

  /**
   * 注册推送 Token 到服务器
   */
  async function registerToken(token: string): Promise<void> {
    try {
      await apiClient.post('/api/v1/push/register', {
        token,
        platform: uni.getSystemInfoSync().platform,
        deviceId: uni.getDeviceInfo().deviceId
      })
    } catch (error) {
      console.error('注册推送 Token 失败:', error)
    }
  }

  /**
   * 处理接收到的推送消息
   */
  function handlePushMessage(msg: any): void {
    const message: PushMessage = {
      id: msg.payload?.id || `msg_${Date.now()}`,
      title: msg.title || '新消息',
      body: msg.content || '',
      type: msg.payload?.type || 'system',
      data: msg.payload?.data,
      receivedAt: Date.now(),
      read: false
    }

    messages.value.unshift(message)
    unreadCount.value++

    // 显示本地通知
    // #ifdef APP-PLUS
    plus.push.createMessage(message.body, JSON.stringify(message), {
      title: message.title
    })
    // #endif
  }

  /**
   * 处理推送点击
   */
  function handlePushClick(msg: any): void {
    const payload = msg.payload

    // 根据消息类型跳转
    switch (payload?.type) {
      case 'publish_success':
        uni.navigateTo({
          url: `/pages/content/detail?id=${payload.data?.contentId}`
        })
        break
      case 'publish_failed':
        uni.navigateTo({
          url: `/pages/content/drafts?highlight=${payload.data?.draftId}`
        })
        break
      case 'analytics_update':
        uni.switchTab({
          url: '/pages/analytics/overview'
        })
        break
      default:
        uni.switchTab({
          url: '/pages/messages/index'
        })
    }

    // 标记已读
    markAsRead(payload?.id)
  }

  /**
   * 标记消息已读
   */
  function markAsRead(messageId: string): void {
    const index = messages.value.findIndex(m => m.id === messageId)
    if (index !== -1 && !messages.value[index].read) {
      messages.value[index].read = true
      unreadCount.value = Math.max(0, unreadCount.value - 1)
    }
  }

  /**
   * 标记全部已读
   */
  function markAllAsRead(): void {
    messages.value.forEach(m => m.read = true)
    unreadCount.value = 0
  }

  // 初始化
  onMounted(() => {
    initPush()
  })

  return {
    messages,
    unreadCount,
    pushToken,
    markAsRead,
    markAllAsRead
  }
}
```

---

## 4. 页面实现

### 4.1 快速记录页面

```vue
<!-- src/pages/ideas/edit.uvue -->
<template>
  <view class="idea-edit">
    <nav-bar title="记录想法" :show-back="true" />

    <view class="content">
      <!-- 输入区域 -->
      <view class="input-area">
        <textarea
          v-model="content"
          class="idea-input"
          placeholder="记录你的想法..."
          :maxlength="2000"
          auto-height
          :focus="true"
        />
        <text class="char-count">{{ content.length }}/2000</text>
      </view>

      <!-- 附件预览 -->
      <view class="attachments" v-if="attachments.length > 0">
        <view
          class="attachment-item"
          v-for="(item, index) in attachments"
          :key="index"
        >
          <image
            v-if="item.type === 'image'"
            :src="item.path"
            mode="aspectFill"
            class="attachment-image"
          />
          <view v-else class="attachment-audio">
            <text class="iconfont icon-audio"></text>
            <text>{{ formatDuration(item.duration || 0) }}</text>
          </view>
          <view class="remove-btn" @click="removeAttachment(index)">
            <text class="iconfont icon-close"></text>
          </view>
        </view>
      </view>

      <!-- 标签 -->
      <view class="tags-area">
        <view class="tags-label">标签</view>
        <view class="tags-list">
          <view
            class="tag-item"
            v-for="tag in tags"
            :key="tag"
            @click="removeTag(tag)"
          >
            <text>{{ tag }}</text>
            <text class="iconfont icon-close"></text>
          </view>
          <input
            v-model="newTag"
            class="tag-input"
            placeholder="添加标签"
            @confirm="addTag"
          />
        </view>
      </view>
    </view>

    <!-- 底部工具栏 -->
    <view class="toolbar">
      <view class="tool-item" @click="handleTakePhoto">
        <text class="iconfont icon-camera"></text>
      </view>
      <view class="tool-item" @click="handlePickImage">
        <text class="iconfont icon-image"></text>
      </view>
      <view class="tool-item" @click="handleRecord">
        <text class="iconfont icon-mic"></text>
      </view>
      <view class="tool-item" @click="handleAIAssist">
        <text class="iconfont icon-ai"></text>
      </view>
      <button class="save-btn" @click="handleSave" :disabled="!canSave">
        保存
      </button>
    </view>

    <!-- 录音弹窗 -->
    <uni-popup ref="recordPopup" type="bottom">
      <view class="record-panel">
        <view class="record-indicator" :class="{ recording: isRecording }">
          <view class="record-wave"></view>
        </view>
        <text class="record-time">{{ formatDuration(recordDuration) }}</text>
        <view class="record-actions">
          <button v-if="!isRecording" @click="startRecord">开始录音</button>
          <button v-else @click="stopRecord" type="warn">停止</button>
        </view>
      </view>
    </uni-popup>
  </view>
</template>

<script setup lang="uts">
import { ref, computed } from 'vue'
import { useIdeas } from '@/composables/useIdeas'
import { useCapture } from '@/composables/useCapture'

interface Attachment {
  path: string
  type: 'image' | 'audio'
  duration?: number
}

const { createIdea } = useIdeas()
const { takePhoto, pickFromGallery, recordAudio, stopRecording, isCapturing } = useCapture()

const content = ref('')
const attachments = ref<Attachment[]>([])
const tags = ref<string[]>([])
const newTag = ref('')
const isRecording = ref(false)
const recordDuration = ref(0)
const recordPopup = ref()

const canSave = computed(() => content.value.trim().length > 0)

// 拍照
async function handleTakePhoto(): Promise<void> {
  try {
    const result = await takePhoto({ compressed: true })
    attachments.value.push({
      path: result.tempFilePath,
      type: 'image'
    })
  } catch (error) {
    uni.showToast({ title: '拍照失败', icon: 'none' })
  }
}

// 从相册选择
async function handlePickImage(): Promise<void> {
  try {
    const results = await pickFromGallery({ maxCount: 9 - attachments.value.length })
    results.forEach(result => {
      attachments.value.push({
        path: result.tempFilePath,
        type: 'image'
      })
    })
  } catch (error) {
    uni.showToast({ title: '选择失败', icon: 'none' })
  }
}

// 录音
function handleRecord(): void {
  recordPopup.value.open()
}

async function startRecord(): Promise<void> {
  isRecording.value = true
  recordDuration.value = 0

  // 开始计时
  const timer = setInterval(() => {
    recordDuration.value++
    if (recordDuration.value >= 60) {
      stopRecord()
    }
  }, 1000)

  try {
    const result = await recordAudio({ maxDuration: 60 })
    clearInterval(timer)
    attachments.value.push({
      path: result.tempFilePath,
      type: 'audio',
      duration: result.duration
    })
    recordPopup.value.close()
  } catch (error) {
    clearInterval(timer)
    uni.showToast({ title: '录音失败', icon: 'none' })
  } finally {
    isRecording.value = false
  }
}

function stopRecord(): void {
  stopRecording()
}

// AI 辅助
function handleAIAssist(): void {
  uni.navigateTo({
    url: `/pages/ideas/ai-assist?content=${encodeURIComponent(content.value)}`
  })
}

// 标签管理
function addTag(): void {
  const tag = newTag.value.trim()
  if (tag && !tags.value.includes(tag) && tags.value.length < 5) {
    tags.value.push(tag)
    newTag.value = ''
  }
}

function removeTag(tag: string): void {
  const index = tags.value.indexOf(tag)
  if (index !== -1) {
    tags.value.splice(index, 1)
  }
}

// 附件管理
function removeAttachment(index: number): void {
  attachments.value.splice(index, 1)
}

// 保存
async function handleSave(): Promise<void> {
  if (!canSave.value) return

  uni.showLoading({ title: '保存中...' })

  try {
    await createIdea({
      content: content.value,
      attachments: attachments.value.map(a => a.path),
      tags: tags.value
    })

    uni.showToast({ title: '保存成功', icon: 'success' })

    setTimeout(() => {
      uni.navigateBack()
    }, 1500)
  } catch (error) {
    uni.showToast({ title: '保存失败', icon: 'none' })
  } finally {
    uni.hideLoading()
  }
}

// 工具函数
function formatDuration(seconds: number): string {
  const mins = Math.floor(seconds / 60)
  const secs = seconds % 60
  return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
}
</script>

<style lang="scss">
.idea-edit {
  min-height: 100vh;
  background: #f5f5f5;
  display: flex;
  flex-direction: column;
}

.content {
  flex: 1;
  padding: 20rpx;
}

.input-area {
  background: #fff;
  border-radius: 16rpx;
  padding: 24rpx;
  margin-bottom: 20rpx;

  .idea-input {
    width: 100%;
    min-height: 200rpx;
    font-size: 32rpx;
    line-height: 1.6;
  }

  .char-count {
    text-align: right;
    font-size: 24rpx;
    color: #999;
    margin-top: 16rpx;
  }
}

.attachments {
  display: flex;
  flex-wrap: wrap;
  gap: 16rpx;
  margin-bottom: 20rpx;

  .attachment-item {
    position: relative;
    width: 160rpx;
    height: 160rpx;
    border-radius: 12rpx;
    overflow: hidden;

    .attachment-image {
      width: 100%;
      height: 100%;
    }

    .attachment-audio {
      width: 100%;
      height: 100%;
      background: #e0e0e0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .remove-btn {
      position: absolute;
      top: 8rpx;
      right: 8rpx;
      width: 40rpx;
      height: 40rpx;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
    }
  }
}

.tags-area {
  background: #fff;
  border-radius: 16rpx;
  padding: 24rpx;

  .tags-label {
    font-size: 28rpx;
    color: #666;
    margin-bottom: 16rpx;
  }

  .tags-list {
    display: flex;
    flex-wrap: wrap;
    gap: 12rpx;

    .tag-item {
      display: flex;
      align-items: center;
      padding: 8rpx 16rpx;
      background: #e8f4fd;
      border-radius: 20rpx;
      font-size: 24rpx;
      color: #1890ff;
    }

    .tag-input {
      flex: 1;
      min-width: 120rpx;
      font-size: 24rpx;
    }
  }
}

.toolbar {
  display: flex;
  align-items: center;
  padding: 20rpx;
  background: #fff;
  border-top: 1rpx solid #eee;
  padding-bottom: calc(20rpx + env(safe-area-inset-bottom));

  .tool-item {
    width: 80rpx;
    height: 80rpx;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40rpx;
    color: #666;

    &:active {
      background: #f5f5f5;
      border-radius: 50%;
    }
  }

  .save-btn {
    margin-left: auto;
    background: #1890ff;
    color: #fff;
    font-size: 28rpx;
    padding: 16rpx 48rpx;
    border-radius: 40rpx;

    &[disabled] {
      background: #ccc;
    }
  }
}

.record-panel {
  background: #fff;
  border-radius: 24rpx 24rpx 0 0;
  padding: 40rpx;
  text-align: center;

  .record-indicator {
    width: 120rpx;
    height: 120rpx;
    margin: 0 auto 24rpx;
    border-radius: 50%;
    background: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;

    &.recording {
      background: #ff4d4f;
      animation: pulse 1s infinite;
    }
  }

  .record-time {
    font-size: 48rpx;
    font-weight: bold;
    margin-bottom: 24rpx;
  }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}
</style>
```

### 4.2 数据概览页面

```vue
<!-- src/pages/analytics/overview.uvue -->
<template>
  <view class="analytics-overview">
    <nav-bar title="数据概览" />

    <!-- 时间筛选 -->
    <view class="time-filter">
      <view
        v-for="period in timePeriods"
        :key="period.value"
        class="filter-item"
        :class="{ active: selectedPeriod === period.value }"
        @click="selectedPeriod = period.value"
      >
        {{ period.label }}
      </view>
    </view>

    <!-- 核心指标 -->
    <view class="stats-grid">
      <stat-card
        title="总阅读"
        :value="stats.totalViews"
        :trend="stats.viewsTrend"
        icon="icon-eye"
      />
      <stat-card
        title="总点赞"
        :value="stats.totalLikes"
        :trend="stats.likesTrend"
        icon="icon-like"
      />
      <stat-card
        title="总评论"
        :value="stats.totalComments"
        :trend="stats.commentsTrend"
        icon="icon-comment"
      />
      <stat-card
        title="新增粉丝"
        :value="stats.newFollowers"
        :trend="stats.followersTrend"
        icon="icon-user-add"
      />
    </view>

    <!-- 趋势图表 -->
    <view class="chart-section">
      <view class="section-header">
        <text class="section-title">数据趋势</text>
        <view class="chart-type-switch">
          <text
            :class="{ active: chartType === 'views' }"
            @click="chartType = 'views'"
          >阅读</text>
          <text
            :class="{ active: chartType === 'engagement' }"
            @click="chartType = 'engagement'"
          >互动</text>
        </view>
      </view>
      <trend-chart
        :data="trendData"
        :type="chartType"
        height="400rpx"
      />
    </view>

    <!-- 平台分布 -->
    <view class="platform-section">
      <view class="section-header">
        <text class="section-title">平台数据</text>
      </view>
      <view class="platform-list">
        <platform-stats
          v-for="platform in platformStats"
          :key="platform.name"
          :platform="platform"
        />
      </view>
    </view>

    <!-- 热门内容 -->
    <view class="hot-content-section">
      <view class="section-header">
        <text class="section-title">热门内容</text>
        <text class="see-all" @click="goToContentList">查看全部</text>
      </view>
      <view class="content-list">
        <view
          v-for="item in hotContent"
          :key="item.id"
          class="content-item"
          @click="goToContent(item.id)"
        >
          <image :src="item.cover" class="content-cover" mode="aspectFill" />
          <view class="content-info">
            <text class="content-title">{{ item.title }}</text>
            <view class="content-stats">
              <text>{{ formatNumber(item.views) }} 阅读</text>
              <text>{{ formatNumber(item.likes) }} 点赞</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</template>

<script setup lang="uts">
import { ref, computed, onMounted, watch } from 'vue'
import { apiClient } from '@/api/client'

// 类型定义
interface Stats {
  totalViews: number
  viewsTrend: number
  totalLikes: number
  likesTrend: number
  totalComments: number
  commentsTrend: number
  newFollowers: number
  followersTrend: number
}

interface TrendDataPoint {
  date: string
  value: number
}

interface PlatformStat {
  name: string
  icon: string
  views: number
  likes: number
  followers: number
}

interface ContentItem {
  id: string
  title: string
  cover: string
  views: number
  likes: number
}

// 时间周期
const timePeriods = [
  { label: '今日', value: 'today' },
  { label: '7天', value: '7d' },
  { label: '30天', value: '30d' },
  { label: '全部', value: 'all' }
]

const selectedPeriod = ref('7d')
const chartType = ref('views')
const isLoading = ref(false)

const stats = ref<Stats>({
  totalViews: 0,
  viewsTrend: 0,
  totalLikes: 0,
  likesTrend: 0,
  totalComments: 0,
  commentsTrend: 0,
  newFollowers: 0,
  followersTrend: 0
})

const trendData = ref<TrendDataPoint[]>([])
const platformStats = ref<PlatformStat[]>([])
const hotContent = ref<ContentItem[]>([])

// 获取数据
async function fetchAnalytics(): Promise<void> {
  isLoading.value = true

  try {
    const response = await apiClient.get<{
      stats: Stats
      trends: TrendDataPoint[]
      platforms: PlatformStat[]
      hotContent: ContentItem[]
    }>('/api/v1/analytics/overview', {
      data: { period: selectedPeriod.value }
    })

    if (response.success && response.data) {
      stats.value = response.data.stats
      trendData.value = response.data.trends
      platformStats.value = response.data.platforms
      hotContent.value = response.data.hotContent
    }
  } catch (error) {
    uni.showToast({ title: '获取数据失败', icon: 'none' })
  } finally {
    isLoading.value = false
  }
}

// 格式化数字
function formatNumber(num: number): string {
  if (num >= 10000) {
    return (num / 10000).toFixed(1) + 'w'
  } else if (num >= 1000) {
    return (num / 1000).toFixed(1) + 'k'
  }
  return num.toString()
}

// 导航
function goToContentList(): void {
  uni.navigateTo({ url: '/pages/content/published' })
}

function goToContent(id: string): void {
  uni.navigateTo({ url: `/pages/content/detail?id=${id}` })
}

// 监听时间周期变化
watch(selectedPeriod, () => {
  fetchAnalytics()
})

onMounted(() => {
  fetchAnalytics()
})
</script>

<style lang="scss">
.analytics-overview {
  min-height: 100vh;
  background: #f5f5f5;
  padding-bottom: calc(120rpx + env(safe-area-inset-bottom));
}

.time-filter {
  display: flex;
  padding: 20rpx;
  background: #fff;

  .filter-item {
    flex: 1;
    text-align: center;
    padding: 16rpx 0;
    font-size: 28rpx;
    color: #666;
    border-radius: 8rpx;

    &.active {
      background: #e8f4fd;
      color: #1890ff;
      font-weight: bold;
    }
  }
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20rpx;
  padding: 20rpx;
}

.chart-section,
.platform-section,
.hot-content-section {
  margin: 20rpx;
  background: #fff;
  border-radius: 16rpx;
  padding: 24rpx;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20rpx;

  .section-title {
    font-size: 32rpx;
    font-weight: bold;
  }

  .see-all {
    font-size: 24rpx;
    color: #1890ff;
  }

  .chart-type-switch {
    display: flex;
    gap: 24rpx;

    text {
      font-size: 24rpx;
      color: #999;

      &.active {
        color: #1890ff;
        font-weight: bold;
      }
    }
  }
}

.platform-list {
  display: flex;
  flex-direction: column;
  gap: 16rpx;
}

.content-list {
  display: flex;
  flex-direction: column;
  gap: 20rpx;

  .content-item {
    display: flex;
    gap: 16rpx;

    .content-cover {
      width: 160rpx;
      height: 120rpx;
      border-radius: 8rpx;
    }

    .content-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;

      .content-title {
        font-size: 28rpx;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .content-stats {
        display: flex;
        gap: 24rpx;
        font-size: 24rpx;
        color: #999;
      }
    }
  }
}
</style>
```

---

## 5. 平台适配

### 5.1 条件编译

```typescript
// src/utils/platform.uts

// 平台检测
export function getPlatform(): 'ios' | 'android' | 'mp-weixin' | 'h5' {
  // #ifdef APP-PLUS
  return uni.getSystemInfoSync().platform as 'ios' | 'android'
  // #endif

  // #ifdef MP-WEIXIN
  return 'mp-weixin'
  // #endif

  // #ifdef H5
  return 'h5'
  // #endif

  return 'h5'
}

// 是否为 App
export function isApp(): boolean {
  // #ifdef APP-PLUS
  return true
  // #endif
  return false
}

// 是否为小程序
export function isMiniProgram(): boolean {
  // #ifdef MP-WEIXIN
  return true
  // #endif
  return false
}

// 获取状态栏高度
export function getStatusBarHeight(): number {
  return uni.getSystemInfoSync().statusBarHeight || 0
}

// 获取安全区域
export function getSafeArea(): { top: number; bottom: number } {
  const info = uni.getSystemInfoSync()
  return {
    top: info.safeAreaInsets?.top || 0,
    bottom: info.safeAreaInsets?.bottom || 0
  }
}
```

### 5.2 小程序特殊处理

```typescript
// src/utils/mp-weixin.uts

// 微信小程序特殊功能

/**
 * 订阅消息
 */
export async function subscribeMessage(tmplIds: string[]): Promise<boolean> {
  // #ifdef MP-WEIXIN
  return new Promise((resolve) => {
    wx.requestSubscribeMessage({
      tmplIds,
      success: (res) => {
        const allAccepted = tmplIds.every(id => res[id] === 'accept')
        resolve(allAccepted)
      },
      fail: () => resolve(false)
    })
  })
  // #endif
  return false
}

/**
 * 小程序分享
 */
export function setupShareMenu(): void {
  // #ifdef MP-WEIXIN
  wx.showShareMenu({
    withShareTicket: true,
    menus: ['shareAppMessage', 'shareTimeline']
  })
  // #endif
}

/**
 * 获取小程序码
 */
export async function getWXACode(
  scene: string,
  page: string
): Promise<string | null> {
  // #ifdef MP-WEIXIN
  try {
    const response = await uni.request({
      url: 'https://api.creatorflow.com/api/v1/wechat/wxacode',
      method: 'POST',
      data: { scene, page }
    })
    return (response.data as any).codeUrl
  } catch (error) {
    return null
  }
  // #endif
  return null
}
```

### 5.3 App 特殊功能

```typescript
// src/plugins/app-features.uts

/**
 * App 专属功能
 */

// 后台运行
export function enableBackgroundMode(): void {
  // #ifdef APP-PLUS
  plus.runtime.setBadgeNumber(0)
  // 保持后台运行
  plus.android?.requestPermissions(['android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS'])
  // #endif
}

// 本地通知
export function showLocalNotification(
  title: string,
  body: string,
  data?: any
): void {
  // #ifdef APP-PLUS
  plus.push.createMessage(body, JSON.stringify(data || {}), {
    title,
    cover: true
  })
  // #endif
}

// 震动反馈
export function vibrate(type: 'light' | 'medium' | 'heavy' = 'light'): void {
  // #ifdef APP-PLUS
  const duration = type === 'light' ? 15 : type === 'medium' ? 30 : 50
  plus.device.vibrate(duration)
  // #endif

  // #ifdef MP-WEIXIN
  uni.vibrateShort({ type })
  // #endif
}

// 生物识别
export async function authenticateWithBiometric(
  reason: string
): Promise<boolean> {
  // #ifdef APP-PLUS
  return new Promise((resolve) => {
    plus.fingerprint.authenticate({
      message: reason,
      success: () => resolve(true),
      fail: () => resolve(false)
    })
  })
  // #endif
  return false
}
```

---

## 6. 配置文件

### 6.1 manifest.json

```json
{
  "name": "创流",
  "appid": "__UNI__CREATORFLOW",
  "description": "AI 创作助手",
  "versionName": "1.0.0",
  "versionCode": "100",
  "transformPx": false,

  "app-plus": {
    "usingComponents": true,
    "nvueStyleCompiler": "uni-app",
    "compilerVersion": 3,
    "splashscreen": {
      "alwaysShowBeforeRender": true,
      "waiting": true,
      "autoclose": true,
      "delay": 0
    },
    "modules": {
      "Camera": {},
      "Record": {},
      "Push": {},
      "Fingerprint": {},
      "Share": {}
    },
    "distribute": {
      "android": {
        "permissions": [
          "<uses-permission android:name=\"android.permission.CAMERA\"/>",
          "<uses-permission android:name=\"android.permission.RECORD_AUDIO\"/>",
          "<uses-permission android:name=\"android.permission.READ_EXTERNAL_STORAGE\"/>",
          "<uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\"/>",
          "<uses-permission android:name=\"android.permission.VIBRATE\"/>",
          "<uses-permission android:name=\"android.permission.INTERNET\"/>",
          "<uses-permission android:name=\"android.permission.USE_FINGERPRINT\"/>"
        ],
        "minSdkVersion": 21,
        "targetSdkVersion": 33
      },
      "ios": {
        "idfa": false,
        "capabilities": {
          "entitlements": {
            "com.apple.developer.associated-domains": [
              "applinks:creatorflow.com"
            ]
          }
        },
        "privacyDescription": {
          "NSCameraUsageDescription": "用于拍摄素材",
          "NSMicrophoneUsageDescription": "用于录制音频",
          "NSPhotoLibraryUsageDescription": "用于选择素材",
          "NSFaceIDUsageDescription": "用于身份验证"
        }
      }
    }
  },

  "mp-weixin": {
    "appid": "wx1234567890abcdef",
    "setting": {
      "urlCheck": false,
      "es6": true,
      "enhance": true,
      "postcss": true,
      "minified": true
    },
    "usingComponents": true,
    "permission": {
      "scope.userLocation": {
        "desc": "用于获取位置信息"
      }
    },
    "requiredPrivateInfos": [
      "chooseImage",
      "chooseVideo"
    ]
  },

  "vueVersion": "3"
}
```

### 6.2 pages.json

```json
{
  "easycom": {
    "autoscan": true,
    "custom": {
      "^uni-(.*)": "@dcloudio/uni-ui/lib/uni-$1/uni-$1.vue",
      "^cool-(.*)": "@/uni_modules/cool-ui/components/cool-$1/cool-$1.uvue"
    }
  },

  "pages": [
    {
      "path": "pages/index/index",
      "style": {
        "navigationBarTitleText": "首页",
        "navigationStyle": "custom"
      }
    },
    {
      "path": "pages/ideas/list",
      "style": {
        "navigationBarTitleText": "想法"
      }
    },
    {
      "path": "pages/ideas/edit",
      "style": {
        "navigationBarTitleText": "记录想法",
        "navigationStyle": "custom"
      }
    },
    {
      "path": "pages/capture/photo",
      "style": {
        "navigationBarTitleText": "拍照",
        "navigationStyle": "custom"
      }
    },
    {
      "path": "pages/content/drafts",
      "style": {
        "navigationBarTitleText": "草稿箱"
      }
    },
    {
      "path": "pages/content/published",
      "style": {
        "navigationBarTitleText": "已发布"
      }
    },
    {
      "path": "pages/content/detail",
      "style": {
        "navigationBarTitleText": "内容详情"
      }
    },
    {
      "path": "pages/analytics/overview",
      "style": {
        "navigationBarTitleText": "数据概览"
      }
    },
    {
      "path": "pages/messages/index",
      "style": {
        "navigationBarTitleText": "消息中心"
      }
    },
    {
      "path": "pages/profile/index",
      "style": {
        "navigationBarTitleText": "我的"
      }
    },
    {
      "path": "pages/profile/accounts",
      "style": {
        "navigationBarTitleText": "账号管理"
      }
    },
    {
      "path": "pages/profile/settings",
      "style": {
        "navigationBarTitleText": "设置"
      }
    }
  ],

  "tabBar": {
    "color": "#999999",
    "selectedColor": "#1890ff",
    "borderStyle": "white",
    "backgroundColor": "#ffffff",
    "list": [
      {
        "pagePath": "pages/index/index",
        "iconPath": "static/icons/tab-home.png",
        "selectedIconPath": "static/icons/tab-home-active.png",
        "text": "首页"
      },
      {
        "pagePath": "pages/ideas/list",
        "iconPath": "static/icons/tab-idea.png",
        "selectedIconPath": "static/icons/tab-idea-active.png",
        "text": "想法"
      },
      {
        "pagePath": "pages/analytics/overview",
        "iconPath": "static/icons/tab-data.png",
        "selectedIconPath": "static/icons/tab-data-active.png",
        "text": "数据"
      },
      {
        "pagePath": "pages/profile/index",
        "iconPath": "static/icons/tab-profile.png",
        "selectedIconPath": "static/icons/tab-profile-active.png",
        "text": "我的"
      }
    ]
  },

  "globalStyle": {
    "navigationBarTextStyle": "black",
    "navigationBarTitleText": "创流",
    "navigationBarBackgroundColor": "#ffffff",
    "backgroundColor": "#f5f5f5"
  }
}
```

---

## 7. 发布配置

### 7.1 iOS 发布

```yaml
# iOS 发布检查清单

证书配置:
  - Apple Developer 账号
  - Distribution 证书
  - App Store Provisioning Profile
  - Push Notification 配置

App Store Connect:
  - 应用信息填写
  - 隐私政策 URL
  - 技术支持 URL
  - 版本说明

审核注意事项:
  - 登录功能必须支持 Sign in with Apple
  - 所有权限需要明确说明用途
  - 不能使用私有 API
  - 必须支持 IPv6
```

### 7.2 Android 发布

```yaml
# Android 发布配置

签名配置:
  - keystore 文件
  - 签名密钥别名
  - 密钥密码

应用市场:
  - 应用宝
  - 华为应用市场
  - 小米应用商店
  - OPPO/vivo 应用商店

注意事项:
  - 64 位支持
  - 隐私合规声明
  - 必要权限说明
  - 目标 SDK 版本 >= 33
```

### 7.3 微信小程序发布

```yaml
# 微信小程序配置

基础配置:
  - AppID 配置
  - 服务器域名白名单
  - 业务域名配置

隐私协议:
  - 用户隐私保护指引
  - 隐私授权弹窗配置

审核注意事项:
  - 类目选择正确
  - 功能与类目匹配
  - 不使用敏感词汇
  - 界面简洁合规
```

---

## 相关文档

- [系统架构](./01-系统架构.md)
- [桌面端设计](./02-桌面端设计.md)
- [云端服务设计](./04-云端服务设计.md)
- [Agent Runtime](./05-Agent-Runtime.md)
