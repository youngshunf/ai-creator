# 01 项目管理开发计划

> 需求来源: `docs/14-MVP需求规格.md` 2.4 项目管理
> 参考文档: `docs/16-数据库设计与同步策略.md`

## 一、需求概述

项目是整个工作区的上下文，所有内容（素材、灵感、创作、作品、平台账号）均与项目关联。

| 需求ID | 功能 | 优先级 |
|--------|------|--------|
| F-MVP-030 | 创建项目 | P0 |
| F-MVP-031 | 行业/领域设置 | P0 |
| F-MVP-032 | 品牌设置 | P0 |
| F-MVP-033 | 关注话题管理 | P0 |
| F-MVP-034 | 账号标签管理 | P1 |
| F-MVP-035 | 账号绑定项目 | P0 |
| F-MVP-036 | 内容归属项目 | P0 |
| F-MVP-037 | 项目切换 | P0 |
| F-MVP-038 | 项目数据隔离 | P0 |

---

## 二、云端 API 开发

### 2.1 数据模型

基于 `docs/16-数据库设计与同步策略.md` 中的 `projects` 表定义。

**文件**: `services/cloud-backend/backend/app/models/project.py`

```python
class Project(Base):
    __tablename__ = "projects"
    
    id: Mapped[UUID] = mapped_column(primary_key=True)
    user_id: Mapped[UUID] = mapped_column(ForeignKey("users.id"))
    name: Mapped[str]
    description: Mapped[str | None]
    
    # 行业领域
    industry: Mapped[str | None]
    sub_industries: Mapped[list[str]] = mapped_column(JSONB, default=list)
    
    # 品牌信息
    brand_name: Mapped[str | None]
    brand_tone: Mapped[str | None]
    brand_keywords: Mapped[list[str]] = mapped_column(JSONB, default=list)
    
    # 内容定位
    topics: Mapped[list[str]] = mapped_column(JSONB, default=list)
    keywords: Mapped[list[str]] = mapped_column(JSONB, default=list)
    account_tags: Mapped[list[str]] = mapped_column(JSONB, default=list)
    
    # 偏好设置
    preferred_platforms: Mapped[list[str]] = mapped_column(JSONB, default=list)
    content_style: Mapped[str | None]
    settings: Mapped[dict] = mapped_column(JSONB, default=dict)
    
    is_default: Mapped[bool] = mapped_column(default=False)
    is_deleted: Mapped[bool] = mapped_column(default=False)
    
    # 同步元数据
    server_version: Mapped[int] = mapped_column(default=0)
    
    created_at: Mapped[datetime]
    updated_at: Mapped[datetime]
```

### 2.2 API 端点

**文件**: `services/cloud-backend/backend/app/api/v1/projects.py`

| Method | Path | 描述 |
|--------|------|------|
| POST | `/api/v1/projects` | 创建项目 |
| GET | `/api/v1/projects` | 获取项目列表 |
| GET | `/api/v1/projects/{id}` | 获取项目详情 |
| PUT | `/api/v1/projects/{id}` | 更新项目 |
| DELETE | `/api/v1/projects/{id}` | 删除项目 |
| POST | `/api/v1/projects/{id}/set-default` | 设为默认项目 |

### 2.3 Schema 定义

**文件**: `services/cloud-backend/backend/app/schemas/project.py`

```python
class ProjectCreate(BaseModel):
    name: str
    description: str | None = None
    industry: str | None = None
    sub_industries: list[str] = []
    brand_name: str | None = None
    brand_tone: str | None = None
    brand_keywords: list[str] = []
    topics: list[str] = []
    keywords: list[str] = []

class ProjectUpdate(BaseModel):
    name: str | None = None
    description: str | None = None
    industry: str | None = None
    sub_industries: list[str] | None = None
    brand_name: str | None = None
    brand_tone: str | None = None
    brand_keywords: list[str] | None = None
    topics: list[str] | None = None
    keywords: list[str] | None = None
    account_tags: list[str] | None = None
    content_style: str | None = None

class ProjectResponse(BaseModel):
    id: UUID
    name: str
    description: str | None
    industry: str | None
    brand_name: str | None
    is_default: bool
    created_at: datetime
```

---

## 三、桌面端开发

### 3.1 本地数据库

已在 `docs/16-数据库设计与同步策略.md` 中定义，需在 Rust Core 中初始化 SQLite。

**文件**: `apps/desktop/src-tauri/src/db/schema.sql` (新增)

### 3.2 前端 UI

#### 3.2.1 项目选择器 (Header)

**文件**: `apps/desktop/src/components/layout/ProjectSelector.tsx` (新增)

- 显示当前项目名称
- 下拉菜单切换项目
- "创建新项目" 入口

#### 3.2.2 项目设置页

**文件**: `apps/desktop/src/routes/settings/project.tsx` (新增)

- 项目基本信息编辑
- 行业/领域选择
- 品牌信息设置
- 关注话题管理

### 3.3 状态管理

**文件**: `apps/desktop/src/stores/useProjectStore.ts` (新增)

```typescript
interface ProjectStore {
  projects: Project[];
  currentProject: Project | null;
  
  // Actions
  fetchProjects: () => Promise<void>;
  createProject: (data: ProjectCreate) => Promise<Project>;
  setCurrentProject: (id: string) => void;
  updateProject: (id: string, data: ProjectUpdate) => Promise<void>;
}
```

### 3.4 Tauri Commands

**文件**: `apps/desktop/src-tauri/src/commands/project.rs` (新增)

```rust
#[tauri::command]
async fn get_projects() -> Result<Vec<Project>, String>;

#[tauri::command]
async fn create_project(data: ProjectCreate) -> Result<Project, String>;

#[tauri::command]
async fn set_current_project(id: String) -> Result<(), String>;
```

---

## 四、Agent 工作流

项目信息需要注入到 AI 创作上下文中。

**文件**: `agent-definitions/content-creation.yaml`

```yaml
# 在 Graph 状态中包含 project_context
inputs:
  project_id: string
  project_context:
    brand_name: string
    brand_tone: string
    topics: list[string]
    keywords: list[string]
```

---

## 五、验证计划

### 5.1 单元测试

**云端**:
```bash
cd services/cloud-backend
pytest backend/tests/test_projects.py -v
```

### 5.2 手动测试

1. **创建项目**:
   - 打开设置 → 项目管理
   - 点击"新建项目"
   - 填写项目名称、行业、品牌信息
   - 保存后应出现在项目列表

2. **切换项目**:
   - 点击 Header 的项目选择器
   - 选择另一个项目
   - 验证侧边栏/编辑器应切换到该项目上下文

3. **项目隔离**:
   - 在项目 A 创建内容
   - 切换到项目 B
   - 验证项目 B 看不到项目 A 的内容

---

## 六、交付物清单

- [ ] `services/cloud-backend/backend/app/models/project.py`
- [ ] `services/cloud-backend/backend/app/api/v1/projects.py`
- [ ] `services/cloud-backend/backend/app/schemas/project.py`
- [ ] `apps/desktop/src-tauri/src/commands/project.rs`
- [ ] `apps/desktop/src/components/layout/ProjectSelector.tsx`
- [ ] `apps/desktop/src/routes/settings/project.tsx`
- [ ] `apps/desktop/src/stores/useProjectStore.ts`
