# AI Creator - 数据模型

> SQLAlchemy 2.0 数据模型设计

## 1. 设计原则

### 1.1 核心原则

- **一致性**: 端侧SQLite与云端PostgreSQL使用相同模型
- **可扩展性**: 支持新平台、新功能的灵活扩展
- **审计追踪**: 重要操作保留完整历史记录
- **软删除**: 重要数据采用软删除策略

### 1.2 命名规范

```yaml
表名: 小写下划线，复数形式 (users, contents, publications)
字段名: 小写下划线 (created_at, user_id)
主键: id (UUID)
外键: {table}_id
时间戳: created_at, updated_at, deleted_at
```

---

## 2. 基础模型

### 2.1 模型基类

```python
# backend/app/models/base.py
from sqlalchemy import Column, DateTime, String, Boolean
from sqlalchemy.orm import declared_attr, declarative_base
from sqlalchemy.dialects.postgresql import UUID
from datetime import datetime
import uuid

Base = declarative_base()

class BaseModel(Base):
    """模型基类"""
    __abstract__ = True

    id = Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        index=True
    )
    created_at = Column(
        DateTime,
        default=datetime.utcnow,
        nullable=False
    )
    updated_at = Column(
        DateTime,
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False
    )

    @declared_attr
    def __tablename__(cls) -> str:
        """自动生成表名"""
        import re
        name = re.sub('(.)([A-Z][a-z]+)', r'\1_\2', cls.__name__)
        return re.sub('([a-z0-9])([A-Z])', r'\1_\2', name).lower() + 's'


class SoftDeleteMixin:
    """软删除混入"""
    deleted_at = Column(DateTime, nullable=True)
    is_deleted = Column(Boolean, default=False, nullable=False)

    def soft_delete(self):
        self.deleted_at = datetime.utcnow()
        self.is_deleted = True
```

---

## 3. 用户模型

### 3.1 用户表

```python
# backend/app/models/user.py
from sqlalchemy import Column, String, Boolean, Integer, Enum as SQLEnum, JSON
from sqlalchemy.orm import relationship
from .base import BaseModel, SoftDeleteMixin
from enum import Enum

class SubscriptionTier(str, Enum):
    """订阅级别"""
    FREE = "free"
    BASIC = "basic"
    PRO = "pro"
    ENTERPRISE = "enterprise"

class User(BaseModel, SoftDeleteMixin):
    """用户表"""
    __tablename__ = "users"

    # 基本信息
    email = Column(String(255), unique=True, nullable=False, index=True)
    username = Column(String(50), unique=True, nullable=True)
    nickname = Column(String(100), nullable=True)
    avatar_url = Column(String(500), nullable=True)
    phone = Column(String(20), nullable=True, unique=True)

    # 认证
    password_hash = Column(String(255), nullable=True)  # OAuth用户可能没有密码
    is_verified = Column(Boolean, default=False)
    is_active = Column(Boolean, default=True)

    # 订阅
    subscription_tier = Column(
        SQLEnum(SubscriptionTier),
        default=SubscriptionTier.FREE,
        nullable=False
    )
    subscription_expires_at = Column(DateTime, nullable=True)

    # 配额
    daily_creation_quota = Column(Integer, default=10)
    daily_publish_quota = Column(Integer, default=20)
    storage_quota_mb = Column(Integer, default=500)

    # 设置
    settings = Column(JSON, default=dict)
    # 示例: {"language": "zh", "timezone": "Asia/Shanghai", "notifications": {...}}

    # 关联
    accounts = relationship("PlatformAccount", back_populates="user")
    contents = relationship("Content", back_populates="user")
    publications = relationship("Publication", back_populates="user")


class UserOAuth(BaseModel):
    """OAuth登录关联"""
    __tablename__ = "user_oauths"

    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
    provider = Column(String(50), nullable=False)  # google, github, wechat
    provider_user_id = Column(String(255), nullable=False)
    access_token = Column(String(500), nullable=True)
    refresh_token = Column(String(500), nullable=True)
    token_expires_at = Column(DateTime, nullable=True)

    __table_args__ = (
        UniqueConstraint('provider', 'provider_user_id', name='uix_oauth_provider_user'),
    )
```

### 3.2 项目表

```python
# backend/app/models/project.py
from sqlalchemy import Column, String, Boolean, ForeignKey, JSON, Text
from sqlalchemy.orm import relationship
from sqlalchemy.dialects.postgresql import UUID, ARRAY
from .base import BaseModel, SoftDeleteMixin

class Project(BaseModel, SoftDeleteMixin):
    """项目表 - 创作上下文的核心实体"""
    __tablename__ = "projects"

    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)

    # 基本信息
    name = Column(String(255), nullable=False)
    description = Column(Text, nullable=True)
    
    # 行业与领域
    industry = Column(String(100), nullable=True)  # 主行业
    sub_industries = Column(ARRAY(String), default=[])  # 细分领域
    
    # 品牌信息
    brand_name = Column(String(255), nullable=True)
    brand_tone = Column(String(100), nullable=True)  # 专业/活泼/奢华/亲民
    brand_keywords = Column(ARRAY(String), default=[])
    
    # 内容定位
    topics = Column(ARRAY(String), default=[])  # 关注话题
    keywords = Column(ARRAY(String), default=[])  # 内容关键词
    account_tags = Column(ARRAY(String), default=[])  # 账号标签/定位
    
    # 偏好设置
    preferred_platforms = Column(ARRAY(String), default=[])  # 优先发布平台
    content_style = Column(String(100), nullable=True)  # 默认内容风格
    
    # 元数据
    is_default = Column(Boolean, default=False)  # 是否为默认项目
    settings = Column(JSON, default=dict)  # 其他配置
    
    # 关联
    user = relationship("User", back_populates="projects")
    accounts = relationship("PlatformAccount", back_populates="project")
    contents = relationship("Content", back_populates="project")
    
    __table_args__ = (
        Index('ix_projects_user', 'user_id'),
    )

# 在 User 模型中添加关联
# projects = relationship("Project", back_populates="user")
```

**项目配额检查逻辑**:

```python
# backend/app/services/project.py
from app.models import User, Project, SubscriptionTier

PROJECT_LIMITS = {
    SubscriptionTier.FREE: 1,
    SubscriptionTier.BASIC: 1,
    SubscriptionTier.PRO: 5,
    SubscriptionTier.ENTERPRISE: float('inf'),
}

async def can_create_project(user: User) -> bool:
    """检查用户是否可以创建新项目"""
    current_count = await db.scalar(
        select(func.count(Project.id))
        .where(Project.user_id == user.id)
        .where(Project.is_deleted == False)
    )
    limit = PROJECT_LIMITS.get(user.subscription_tier, 1)
    return current_count < limit
```

### 4.1 平台账号表

```python
# backend/app/models/account.py
from sqlalchemy import Column, String, Boolean, ForeignKey, JSON, Text
from sqlalchemy.orm import relationship
from sqlalchemy.dialects.postgresql import UUID
from .base import BaseModel, SoftDeleteMixin

class PlatformAccount(BaseModel, SoftDeleteMixin):
    """平台账号表"""
    __tablename__ = "platform_accounts"

    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
    project_id = Column(UUID(as_uuid=True), ForeignKey("projects.id"), nullable=False)  # 账号绑定项目

    # 平台信息
    platform = Column(String(50), nullable=False, index=True)
    # xiaohongshu, douyin, weibo, wechat_mp, bilibili, zhihu, kuaishou

    # 账号信息
    account_id = Column(String(255), nullable=False)  # 平台内的用户ID
    account_name = Column(String(255), nullable=True)  # 账号名称/昵称
    avatar_url = Column(String(500), nullable=True)

    # 状态
    is_active = Column(Boolean, default=True)
    session_valid = Column(Boolean, default=True)
    last_session_check = Column(DateTime, nullable=True)

    # 统计（缓存）
    followers_count = Column(Integer, default=0)
    following_count = Column(Integer, default=0)
    posts_count = Column(Integer, default=0)

    # 元数据
    metadata = Column(JSON, default=dict)
    # 示例: {"verified": true, "level": 5, "category": "美食"}

    # 关联
    user = relationship("User", back_populates="accounts")
    project = relationship("Project", back_populates="accounts")  # 项目关联
    publications = relationship("Publication", back_populates="account")

    __table_args__ = (
        UniqueConstraint('user_id', 'platform', 'account_id', name='uix_user_platform_account'),
        Index('ix_platform_accounts_platform', 'platform'),
    )


class EncryptedCredentialRecord(BaseModel):
    """加密凭证记录（云端存储）"""
    __tablename__ = "encrypted_credentials"

    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
    platform = Column(String(50), nullable=False)
    account_id = Column(String(255), nullable=False)

    # 加密数据（双重加密后的密文）
    encrypted_data = Column(JSON, nullable=False)
    # 结构: {"ciphertext": "...", "iv": "...", "salt": "...", "version": 2}

    # 同步信息
    created_device = Column(String(255), nullable=False)  # 首次上传的设备
    last_updated_device = Column(String(255), nullable=False)

    __table_args__ = (
        UniqueConstraint('user_id', 'platform', 'account_id', name='uix_credential'),
    )
```

---

## 5. 内容模型

### 5.1 内容表

```python
# backend/app/models/content.py
from sqlalchemy import Column, String, Text, Integer, ForeignKey, JSON, Enum as SQLEnum
from sqlalchemy.orm import relationship
from sqlalchemy.dialects.postgresql import UUID, ARRAY
from .base import BaseModel, SoftDeleteMixin
from enum import Enum

class ContentType(str, Enum):
    """内容类型"""
    TEXT = "text"
    IMAGE = "image"
    VIDEO = "video"
    ARTICLE = "article"

class ContentStatus(str, Enum):
    """内容状态"""
    DRAFT = "draft"
    READY = "ready"
    PUBLISHED = "published"
    ARCHIVED = "archived"

class Content(BaseModel, SoftDeleteMixin):
    """内容表"""
    __tablename__ = "contents"

    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
    project_id = Column(UUID(as_uuid=True), ForeignKey("projects.id"), nullable=False)  # 内容归属项目

    # 基本信息
    title = Column(String(500), nullable=True)
    content_type = Column(SQLEnum(ContentType), nullable=False)
    status = Column(SQLEnum(ContentStatus), default=ContentStatus.DRAFT)

    # 内容
    text_content = Column(Text, nullable=True)  # 正文内容
    summary = Column(Text, nullable=True)       # 摘要

    # 媒体文件
    media_urls = Column(ARRAY(String), default=[])  # 图片/视频URL列表
    cover_url = Column(String(500), nullable=True)  # 封面图

    # 元数据
    tags = Column(ARRAY(String), default=[])        # 标签
    keywords = Column(ARRAY(String), default=[])    # SEO关键词
    word_count = Column(Integer, default=0)
    read_time_minutes = Column(Integer, default=0)

    # AI生成元数据
    ai_generated = Column(Boolean, default=False)
    generation_params = Column(JSON, nullable=True)
    # 示例: {"model": "claude-sonnet", "topic": "...", "style": "..."}

    # 版本控制
    version = Column(Integer, default=1)
    parent_id = Column(UUID(as_uuid=True), ForeignKey("contents.id"), nullable=True)

    # 关联
    user = relationship("User", back_populates="contents")
    project = relationship("Project", back_populates="contents")  # 项目关联
    publications = relationship("Publication", back_populates="content")
    parent = relationship("Content", remote_side=[id])


class ContentVersion(BaseModel):
    """内容版本历史"""
    __tablename__ = "content_versions"

    content_id = Column(UUID(as_uuid=True), ForeignKey("contents.id"), nullable=False)
    version = Column(Integer, nullable=False)

    # 快照
    title = Column(String(500), nullable=True)
    text_content = Column(Text, nullable=True)
    media_urls = Column(ARRAY(String), default=[])

    # 变更信息
    change_summary = Column(String(500), nullable=True)
    changed_by = Column(String(50), default="user")  # user, ai, auto

    __table_args__ = (
        UniqueConstraint('content_id', 'version', name='uix_content_version'),
    )
```

### 5.2 素材表

```python
# backend/app/models/material.py
from sqlalchemy import Column, String, Integer, ForeignKey, JSON, BigInteger
from sqlalchemy.dialects.postgresql import UUID
from .base import BaseModel, SoftDeleteMixin

class MaterialType(str, Enum):
    """素材类型"""
    IMAGE = "image"
    VIDEO = "video"
    AUDIO = "audio"
    DOCUMENT = "document"

class Material(BaseModel, SoftDeleteMixin):
    """素材库"""
    __tablename__ = "materials"

    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)

    # 文件信息
    filename = Column(String(255), nullable=False)
    file_type = Column(SQLEnum(MaterialType), nullable=False)
    mime_type = Column(String(100), nullable=False)
    file_size = Column(BigInteger, nullable=False)  # 字节

    # 存储
    storage_path = Column(String(500), nullable=False)  # S3/MinIO路径
    url = Column(String(500), nullable=False)           # CDN URL
    thumbnail_url = Column(String(500), nullable=True)

    # 媒体元数据
    width = Column(Integer, nullable=True)
    height = Column(Integer, nullable=True)
    duration_seconds = Column(Integer, nullable=True)  # 视频/音频时长

    # 分类
    folder = Column(String(255), default="default")
    tags = Column(ARRAY(String), default=[])

    # AI分析结果
    ai_description = Column(Text, nullable=True)  # AI生成的描述
    ai_tags = Column(ARRAY(String), default=[])   # AI识别的标签
    ocr_text = Column(Text, nullable=True)        # OCR识别文字

    # 使用统计
    use_count = Column(Integer, default=0)
```

---

## 6. 发布模型

### 6.1 发布任务表

```python
# backend/app/models/publication.py
from sqlalchemy import Column, String, Text, ForeignKey, JSON, Enum as SQLEnum
from sqlalchemy.orm import relationship
from sqlalchemy.dialects.postgresql import UUID
from .base import BaseModel
from enum import Enum
from datetime import datetime

class PublishStatus(str, Enum):
    """发布状态"""
    PENDING = "pending"       # 待发布
    SCHEDULED = "scheduled"   # 已计划
    PUBLISHING = "publishing" # 发布中
    PUBLISHED = "published"   # 已发布
    FAILED = "failed"         # 发布失败
    CANCELLED = "cancelled"   # 已取消

class Publication(BaseModel):
    """发布任务表"""
    __tablename__ = "publications"

    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
    content_id = Column(UUID(as_uuid=True), ForeignKey("contents.id"), nullable=False)
    account_id = Column(UUID(as_uuid=True), ForeignKey("platform_accounts.id"), nullable=False)

    # 平台信息
    platform = Column(String(50), nullable=False, index=True)

    # 状态
    status = Column(SQLEnum(PublishStatus), default=PublishStatus.PENDING)

    # 发布内容（平台适配后的版本）
    adapted_content = Column(JSON, nullable=True)
    # 示例: {"title": "...", "text": "...", "images": [...], "tags": [...]}

    # 定时发布
    scheduled_at = Column(DateTime, nullable=True)

    # 发布结果
    published_at = Column(DateTime, nullable=True)
    platform_post_id = Column(String(255), nullable=True)  # 平台帖子ID
    platform_post_url = Column(String(500), nullable=True) # 平台帖子URL

    # 错误信息
    error_message = Column(Text, nullable=True)
    retry_count = Column(Integer, default=0)
    last_retry_at = Column(DateTime, nullable=True)

    # 关联
    user = relationship("User", back_populates="publications")
    content = relationship("Content", back_populates="publications")
    account = relationship("PlatformAccount", back_populates="publications")
    analytics = relationship("PublicationAnalytics", back_populates="publication")

    __table_args__ = (
        Index('ix_publications_status', 'status'),
        Index('ix_publications_scheduled', 'scheduled_at'),
    )


class PublicationAnalytics(BaseModel):
    """发布数据分析"""
    __tablename__ = "publication_analytics"

    publication_id = Column(
        UUID(as_uuid=True),
        ForeignKey("publications.id"),
        nullable=False
    )

    # 数据指标
    views = Column(Integer, default=0)
    likes = Column(Integer, default=0)
    comments = Column(Integer, default=0)
    shares = Column(Integer, default=0)
    favorites = Column(Integer, default=0)
    followers_gained = Column(Integer, default=0)

    # 采集时间
    fetched_at = Column(DateTime, nullable=False)

    # 原始数据
    raw_data = Column(JSON, nullable=True)

    # 关联
    publication = relationship("Publication", back_populates="analytics")

    __table_args__ = (
        Index('ix_analytics_publication_time', 'publication_id', 'fetched_at'),
    )
```

---

## 7. 任务模型

### 7.1 任务队列表

```python
# backend/app/models/task.py
from sqlalchemy import Column, String, Text, JSON, Enum as SQLEnum, Integer
from sqlalchemy.dialects.postgresql import UUID
from .base import BaseModel
from enum import Enum

class TaskType(str, Enum):
    """任务类型"""
    PUBLISH = "publish"
    ANALYTICS = "analytics"
    AI_GENERATION = "ai_generation"
    SYNC = "sync"
    CLEANUP = "cleanup"

class TaskStatus(str, Enum):
    """任务状态"""
    PENDING = "pending"
    RUNNING = "running"
    COMPLETED = "completed"
    FAILED = "failed"
    CANCELLED = "cancelled"

class TaskRecord(BaseModel):
    """任务记录表"""
    __tablename__ = "task_records"

    user_id = Column(UUID(as_uuid=True), nullable=True)  # 系统任务可能没有用户

    # 任务信息
    task_type = Column(SQLEnum(TaskType), nullable=False)
    status = Column(SQLEnum(TaskStatus), default=TaskStatus.PENDING)

    # 任务参数
    params = Column(JSON, nullable=True)

    # 执行信息
    started_at = Column(DateTime, nullable=True)
    completed_at = Column(DateTime, nullable=True)
    runtime_seconds = Column(Integer, nullable=True)

    # 结果
    result = Column(JSON, nullable=True)
    error = Column(Text, nullable=True)

    # 重试
    retry_count = Column(Integer, default=0)
    max_retries = Column(Integer, default=3)

    # Celery任务ID
    celery_task_id = Column(String(255), nullable=True, index=True)

    __table_args__ = (
        Index('ix_tasks_status_type', 'status', 'task_type'),
    )


class ScheduledTask(BaseModel):
    """定时任务表"""
    __tablename__ = "scheduled_tasks"

    user_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)

    # 任务信息
    name = Column(String(255), nullable=False)
    task_type = Column(SQLEnum(TaskType), nullable=False)
    params = Column(JSON, nullable=True)

    # 调度
    cron_expression = Column(String(100), nullable=True)  # Cron表达式
    run_at = Column(DateTime, nullable=True)              # 一次性执行时间

    # 状态
    is_active = Column(Boolean, default=True)
    last_run_at = Column(DateTime, nullable=True)
    next_run_at = Column(DateTime, nullable=True)

    # 执行统计
    run_count = Column(Integer, default=0)
    fail_count = Column(Integer, default=0)
```

---

## 8. 数据关系图

### 8.1 ER图

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                              数据模型关系图                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────┐       ┌──────────────────┐       ┌──────────────────┐    │
│  │    User      │──────<│ PlatformAccount  │──────<│  Publication     │    │
│  │              │       │                  │       │                  │    │
│  │ - id         │       │ - id             │       │ - id             │    │
│  │ - email      │       │ - user_id        │       │ - user_id        │    │
│  │ - username   │       │ - platform       │       │ - content_id     │    │
│  │ - tier       │       │ - account_id     │       │ - account_id     │    │
│  └──────┬───────┘       │ - session_valid  │       │ - status         │    │
│         │               └──────────────────┘       │ - scheduled_at   │    │
│         │                        │                 │ - published_at   │    │
│         │                        │                 └────────┬─────────┘    │
│         │                        │                          │              │
│         │               ┌────────┴─────────┐                │              │
│         │               │                  │                │              │
│         ▼               ▼                  │                ▼              │
│  ┌──────────────┐  ┌───────────────┐       │     ┌──────────────────┐     │
│  │   Content    │  │ Encrypted     │       │     │ Publication      │     │
│  │              │  │ Credential    │       │     │ Analytics        │     │
│  │ - id         │  │               │       │     │                  │     │
│  │ - user_id    │  │ - user_id     │       │     │ - publication_id │     │
│  │ - title      │  │ - platform    │       │     │ - views          │     │
│  │ - content    │  │ - account_id  │       │     │ - likes          │     │
│  │ - status     │  │ - encrypted   │       │     │ - comments       │     │
│  └──────┬───────┘  └───────────────┘       │     └──────────────────┘     │
│         │                                  │                               │
│         │                                  │                               │
│         ▼                                  │                               │
│  ┌──────────────┐                          │                               │
│  │   Material   │                          │                               │
│  │              │                          │                               │
│  │ - id         │                          │                               │
│  │ - user_id    │                          │                               │
│  │ - file_type  │                          │                               │
│  │ - url        │◄─────────────────────────┘                               │
│  └──────────────┘                                                          │
│                                                                             │
│  ┌──────────────┐       ┌──────────────────┐                               │
│  │ TaskRecord   │       │ ScheduledTask    │                               │
│  │              │       │                  │                               │
│  │ - id         │       │ - id             │                               │
│  │ - user_id    │       │ - user_id        │                               │
│  │ - task_type  │       │ - cron_expr      │                               │
│  │ - status     │       │ - is_active      │                               │
│  └──────────────┘       └──────────────────┘                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. 索引策略

### 9.1 常用索引

```python
# 在模型中定义索引
__table_args__ = (
    # 复合索引
    Index('ix_publications_user_status', 'user_id', 'status'),
    Index('ix_publications_platform_scheduled', 'platform', 'scheduled_at'),

    # 部分索引（PostgreSQL特性）
    Index(
        'ix_publications_pending',
        'scheduled_at',
        postgresql_where=(status == 'pending')
    ),

    # GIN索引（用于JSON和数组）
    Index('ix_contents_tags', 'tags', postgresql_using='gin'),
)
```

### 9.2 查询优化建议

```yaml
高频查询:
  用户内容列表:
    索引: (user_id, status, created_at DESC)
    分页: keyset pagination (cursor-based)

  待发布任务:
    索引: (status, scheduled_at)
    条件: status = 'scheduled' AND scheduled_at <= NOW()

  数据分析:
    索引: (publication_id, fetched_at DESC)
    聚合: 预计算每日/周/月汇总

  素材搜索:
    索引: GIN(tags), 全文索引(ai_description)
```

---

## 10. 数据迁移

### 10.1 Alembic配置

```python
# alembic/env.py
from app.models import Base
from app.core.config import get_settings

settings = get_settings()

def run_migrations_online():
    connectable = create_engine(settings.DATABASE_URL)

    with connectable.connect() as connection:
        context.configure(
            connection=connection,
            target_metadata=Base.metadata,
            compare_type=True,
            compare_server_default=True,
        )

        with context.begin_transaction():
            context.run_migrations()
```

### 10.2 迁移示例

```python
# alembic/versions/001_initial.py
"""Initial migration

Revision ID: 001
"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects.postgresql import UUID, ARRAY

def upgrade():
    # 创建用户表
    op.create_table(
        'users',
        sa.Column('id', UUID(as_uuid=True), primary_key=True),
        sa.Column('email', sa.String(255), nullable=False, unique=True),
        sa.Column('username', sa.String(50), nullable=True, unique=True),
        sa.Column('password_hash', sa.String(255), nullable=True),
        sa.Column('subscription_tier', sa.String(50), default='free'),
        sa.Column('created_at', sa.DateTime, nullable=False),
        sa.Column('updated_at', sa.DateTime, nullable=False),
        sa.Column('deleted_at', sa.DateTime, nullable=True),
        sa.Column('is_deleted', sa.Boolean, default=False),
    )

    op.create_index('ix_users_email', 'users', ['email'])

def downgrade():
    op.drop_table('users')
```

---

## 相关文档

- [云端服务设计](./04-云端服务设计.md)
- [Agent Runtime](./05-Agent-Runtime.md)
- [商业模式](./09-商业模式.md)
